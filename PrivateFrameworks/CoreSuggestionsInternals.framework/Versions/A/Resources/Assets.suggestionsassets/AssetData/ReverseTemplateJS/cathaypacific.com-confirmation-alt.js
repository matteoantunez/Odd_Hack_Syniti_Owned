(function(){return function(e,t,a){if(int(e.epoch)<1356998400)return CONTINUE;var r,n=Scanner.fromMessage(e);n.setLocale(t);var i,l,d,g,s,p,o,m,T,h,c=[],u=[];r=n.getSpan().nextRegExp(a.bookingReference).nextAnyTag("td").tagContents();var f=n.getSpan().next(a.payment).parentAnyTag("td").next(a.fare).parentAnyTag("td").tagContents().toString().match(regExpFormatted(/\1\s*(.*)/,a.fare));f.length>1&&(h=(f=f[1].match(/([a-zA-Z]{3})\s?([\d,.\s]+)/))[1],T=f[2].trim());var A=[];if(0===(u=n.getSpan().next(a.passengers).parentAnyTag("td").nextAnyTag("table").allInnerTagsFiltered("td7").filter(function(e){return/^(?:Mr|Miss|Mrs|Ms|M.|M|Mme|Prof|DR|Dr|Dr\.).*/.test(e)})).length)for(var S=n.getSpan().next(a.passengers).parentAnyTag("td").nextAnyTag("table").allInnerTagsFiltered("td7"),y=0;y<S.length;y++)1!==y&&2!==y&&u.push(S[y]);d=n.getSpan().next(a.itineraryDetails).parentAnyTag("td").next(a.dep).parentAnyTag("tr"),p=n.getSpan().next(a.itineraryDetails).parentAnyTag("td").next(a.ret).parentAnyTag("tr"),A=n.getSpan().next(a.itineraryDetails).parentAnyTag("td").allInnerTagsFiltered("table9");var v=/^([a-zA-Z]{2,3})(\d+)\s*\[.*\]\s*[a-zA-Z\.]*\s*(\d+.*\d+)/;"ja_JP"===t&&(v=/([a-zA-Z]{2,3})(\d+)\s*\[.*\]\s*[a-zA-Z\.]*\s*(\d+.*\d+).*/);var x,b=/^([a-zA-Z]{2,3})\s*(\d+:\d+)\s*([a-zA-Z]{2,3})\s*(\d+:\d+\s*\+?\d*).*[\n]{0,2}.*/,D=!1,C=0,$=0,F=!1,N=!1,z=!1;if(d.isNullSpan_){if(d.isNullSpan_&&p.isNullSpan_){var E=n.getSpan().toString().match(regExpFormatted(/\1\s*\d?\d+/g,a.flight)).length;for(L=1;L<E+1;L++){var I=a.flight+" "+L.toString(),R=n.getSpan().next(I).parentAnyTag("table").parentAnyTag("table"),Z=(R.allInnerTagsFiltered("td8"),R.nextTag("table9").allInnerTagsFiltered("td9")),M=R.nextTag("table10").allInnerTagsFiltered("td10"),_=R.nextTag("table10").nextTag("table9").allInnerTagsFiltered("td9"),k=R.nextTag("table10").nextTag("table9").nextTag("table9").allInnerTagsFiltered("td9").toString().match(regExpFormatted(/\1\s+(.*)/,a.seatRef));k=k[k.length-1].toString().split(", ");var P=M[0].innerCapture(/($<codeDep>[a-zA-Z]+)\s*($<dateDep>\d?\d:\d{2})\s*($<codeAr>[a-zA-Z]+)\s*($<dateAr>\d?\d:\d{2})/),j=Z[0].innerCapture(/($<code>[a-zA-Z]{2,3})($<flightNumber>\d+)/),q=Z[1];if(m=P?P.$codeDep:null,s=P?P.$codeAr:null,o=P?P.$dateAr:null,null!==(g=P?P.$dateDep:null)&&(g=combineDateAndTime(q,g)),null!==o&&(o=combineDateAndTime(q,o)),l=j?j.$code:null,i=j?j.$flightNumbers:null,ASSERT(m,s,g,o)){var J={departureCode:m,arrivalCode:s,departureTime:g,arrivalTime:o,airlineCode:l,flightNumber:i};0!==_.length&&(J.seatingType=_[0],z=!0),0!==k.lenght&&(J.seats=k,N=!0),c.push(J)}}}}else for(var L=0;L<A.length&&!(F&&L+C>=A.length-1);L++)if(L%3==0)regExpFormatted(/\1/,a.request).test(A[L+C])?(D=!0,F=!0,$=L+C+1):$=L+C,l=A[$].replace(v,"$1"),i=A[$].replace(v,"$2"),q=A[$].innerDate();else if(L%3==1){m=A[$=D?L+C+1:L+C].replace(b,"$1"),g=combineDateAndTime(unSpanDate_(q),A[$].replace(b,"$2")),s=A[$].replace(b,"$3");var O=[];(O=(o=A[$].replace(b,"$4").trim()).toString().match(/(\d{2}:\d{2})\s*(\+\d+)?/))[O.length-1]?(q=modifyDate(q,1),o=o.replace(/(\d{2}:\d{2})\s*(\+\d+)?/,"$1"),o=combineDateAndTime(unSpanDate_(q),o)):o=combineDateAndTime(unSpanDate_(q),o)}else if(D?($=L+C+1,C++):$=L+C,regExpFormatted(/^\1\s+.*/,a.seatRef).test(A[$+1])&&A[$+1]!==undefined&&(N=!0,x=(x=A[$+1].toString().match(regExpFormatted(/\1\s+(.*)/,a.seatRef)))[x.length-1].toString().split(", ")),_=A[$],D=!1,z=!0,ASSERT(l,i,g,m,o,s)){var U={airlineCode:l,flightNumber:i,departureTime:g,departureCode:m,arrivalTime:o,arrivalCode:s,seatingType:_};N&&(U.seats=x),c.push(U)}var w=[];for(L=0;L<c.length;L++){var B,G=c[L];N=!0,(B=G.seats)===undefined&&(N=!1);for(var H=0;H<u.length;H++){var K={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineCode:G.airlineCode,flightNumber:G.flightNumber,departureAirportCode:G.departureCode.toString(),departureTime:G.departureTime,arrivalAirportCode:G.arrivalCode.toString(),arrivalTime:G.arrivalTime},underName:{"@type":"http://schema.org/Person",name:u[H]},reservationId:r,priceCurrency:h,totalPrice:T,reservationStatus:"http://schema.org/ReservationConfirmed"};z&&(K.reservedTicket=N?{"@type":"http://schema.org/Ticket",ticketedSeat:{"@type":"http://schema.org/Seat",seatingType:G.seatingType,seatNumber:B[H]}}:{"@type":"http://schema.org/Ticket",ticketedSeat:{"@type":"http://schema.org/Seat",seatingType:G.seatingType}}),w.push(K)}}return w}}).call();