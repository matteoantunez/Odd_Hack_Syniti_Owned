(function(){return function(e,r,t){var a,i,n=Scanner.fromMessage(e);n.setLocale(r);var p,o,s,g,l,m,d,u,h,c,T,v,b,N=[],C={};a=n.getSpan().nextText(t.reference).nextAnyTag("td").tagContents(),g=n.getSpan().nextText(t.passenger).withEnd(n.getSpan().nextText(t.payment).getStart()).allInnerTagsFiltered("td3");for(var y=0;y<g.length;y+=2)g[y]&&g[y+1]&&(C[g[y].toString()]={name:g[y],seats:{},seatingType:{},ticketNumber:g[y+1].innerCapture(/(\d+)/,1)});o=n.getSpan().allInnerTags("table3");for(y=0;y<o.length;y++)if(o[y].innerTag("td3").innerText(t.flightNumber).exists()){var f=o[y].collapseToStart().withStart(o[y].previousTag("table3").getEnd()),S=new RegExp(["($<departureTime>d{2}:d{2})s+($<departureAirport>.*)s+(.*s+(","($<departureCode>[A-Z]{3})))s+-s+($<arrivalTime>d{2}:d{2})","($<arrivalAirport>.*?)s+(.*s+(($<arrivalCode>[A-Z]{3})))"].join(""));if((g=f.innerCapture(S))&&(u=n.getDetachedSpan(f.innerDate().toString()+" "+g.$departureTime.toString()).innerDate(),h=g.$departureAirport,c=g.$departureCode,T=n.getDetachedSpan(f.innerDate().toString()+" "+g.$arrivalTime.toString()).innerDate(),v=g.$arrivalAirport,b=g.$arrivalCode),d=(l=o[y].innerText(t.flightNumber).nextAnyTag("td").tagContents().innerCapture(/($<code>\D+)($<flightNumber>\d+)/))?l.$code:null,s=l?l.$flightNumber:null,m=o[y].innerText(t.operated).nextAnyTag("td").tagContents(),p=o[y].innerText(t["class"]).nextAnyTag("td").tagContents(),valid(s,p))for(var A=Object.keys(C),x=0;x<A.length;x++)C[A[x]].seatingType[s.toString()]=p;ASSERT(d,s,c,u,b,T)&&N.push({airlineName:m,airlineCode:d,flightNumber:s,departureCode:c,departureAirport:h,departureTime:u,arrivalCode:b,arrivalAirport:v,arrivalTime:T,passengers:C}),m=d=s=c=h=u=b=v=T=null}var $=[];for(y=0;y<N.length;y++)for(var k=N[y],D=Object.keys(k.passengers),F=0;F<D.length;F++){var z=k.passengers[D[F]],E={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:k.airlineName,airlineCode:k.airlineCode,flightNumber:k.flightNumber,departureAirportFuzzy:k.departureAirport,departureAirportCode:k.departureCode,departureTime:k.departureTime,arrivalAirportFuzzy:k.arrivalAirport,arrivalAirportCode:k.arrivalCode,arrivalTime:k.arrivalTime},underName:{"@type":"http://schema.org/Person",name:z.name,email:z.email},checkinUrl:i,reservationId:a,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:z.totalPrice,priceCurrency:z.priceCurrency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:z.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:z.seats[k.flightNumber],seatingType:z.seatingType[k.flightNumber]}}};valid(z.membershipNumber,z.programName)&&(E.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:z.membershipNumber,programName:z.programName}),$.push(E)}return $.length?$:CONTINUE}}).call();