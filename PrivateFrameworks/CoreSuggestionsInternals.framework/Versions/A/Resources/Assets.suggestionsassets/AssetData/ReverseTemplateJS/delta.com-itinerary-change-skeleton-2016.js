(function(){return function(e,r,t){if(/(?:Your Delta itinerary has changed|Schedule Changes That Impact)/.test(e.subject)){var a,i=Scanner.fromMessage(e);i.setLocale(r);var n,p,s,g,m,o,l,h,u=[],d={};if(n=i.getSpan().nextTag("td4").nextTag("td4").getString().match(/([A-Z]{2,})/g))for(k=0;k<n.length;k++){var T;d[T=n[k]]={name:T,seats:{},seatingType:{}}}a=i.getSpan().innerCapture(t.confirmationNumber,1);for(var c=i.getSpan().nextTag("table11"),v=c;(c=c.nextTag("table11")).exists();)v=c;for(v=v.nextTag("table8");(v=v.nextTag("table8")).exists();){var b=v.allInnerTagsFiltered("td8");if(b.length>2){p=b[2].getString().replace(/<[^>]+?>/,"").trim().split(",");for(var f=b[0].innerCapture(/(\d+)/,1),x=0;x<p.length;x++)d[n[x]].seatingType[f]=b[1].getString(),d[n[x]].seats[f]=p[x]}}for(c=i.getSpan().nextTag("table11");c.exists();){var N=c.allInnerTagsFiltered("tr11");for(w=0;w<N.length;w+=2){var y=N[w],C=y.nextDate();m=combineDateAndTime(C,C.nextDate());var S=(l=C.nextDate().nextDate()).nextDate();l=S.exists()?combineDateAndTime(S,l):combineDateAndTime(C,l),g=y.innerCapture(/(\w+)/,1),s=y.innerCapture(/\w+\s+(\d+)/,1);var A=y.nextTag("td11");o=A.innerCapture(/((?:[\w -]+)?, ?\w+ ?\w*)/,1),h=(A=A.nextTag("td11")).innerCapture(/((?:[\w -]+)?, ?\w+ ?\w*)/,1),ASSERT(g,s,o,m,h,l)&&u.push({airlineName:g,airlineCode:"DELTA"==g.getString()?"DL":null,flightNumber:s,departureAirport:o,departureTime:m,arrivalAirport:h,arrivalTime:l,passengers:d})}c=c.nextTag("table11")}for(var D=[],w=0;w<u.length;w++)for(var F=u[w],z=Object.keys(F.passengers),k=0;k<z.length;k++){var I=F.passengers[z[k]],L={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:F.airlineName,airlineCode:F.airlineCode,flightNumber:F.flightNumber,departureAirportFuzzy:F.departureAirport,departureAirportCode:F.departureCode,departureTime:F.departureTime,arrivalAirportFuzzy:F.arrivalAirport,arrivalAirportCode:F.arrivalCode,arrivalTime:F.arrivalTime},underName:{"@type":"http://schema.org/Person",name:I.name},reservationId:a,reservationStatus:"http://schema.org/ReservationConfirmed",reservedTicket:{"@type":"http://schema.org/Ticket",ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:I.seats[F.flightNumber],seatingType:I.seatingType[F.flightNumber]}}};valid(I.membershipNumber,I.programName)&&(L.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:I.membershipNumber,programName:I.programName}),D.push(L)}if(D.length)return D}}}).call();