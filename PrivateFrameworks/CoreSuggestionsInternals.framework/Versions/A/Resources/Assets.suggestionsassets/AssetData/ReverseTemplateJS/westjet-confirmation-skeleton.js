(function(){return function(e,t,r){var a,n,i,l,o,g,p,s,u,m,h,c=Scanner.fromMessage(e);c.setLocale(t);var d=[],C=[],T=[];for(a=c.getSpan().innerCapture(regExpFormatted(/\1\s+(\w+)/,r.reservationId),1),g=c.getSpan().next(r.passengerDetails).nextTag("table1").allInnerTags("tr1"),o=0;o<g.length;o+=3)(s={}).name=g[o].nextTag("td1").tagContents(),s.ticketNumber=g[o].next(r.ticketNumber).nextTag("td1").tagContents().toString(),s.seatInfo=g[o].nextText("Seat").nextAnyTag("td").tagContents().split(";"),0!==s.name.toString().length&&d.push(s);i=(n=c.getSpan().next(r.price).parentAnyTag("td").tagContents().innerCapture(/($<priceCurrency>[A-Z]+)\s($<totalPrice>[\d\.,]+)/)).$totalPrice,l=n.$priceCurrency;var v=c.getSpan().next(r.flightDetails).nextTag("table1");do{var f=v.allInnerTags("tr1");for(o=0;o<f.length;o++)u={},(p=f[o].allInnerTags("td1")).length>2&&(u.departureTime=p[1].allInnerDates()[0],u.arrivalTime=p[2].allInnerDates()[0],u.departureAirport=p[1].tagContents().innerCapture(/(.*)\n/,1),u.arrivalAirport=p[2].tagContents().innerCapture(/(.*)\n/,1),m=p[0].tagContents().innerCapture(/($<airlineCode>\w{2})($<flightNumber>\d+)/),u.airlineCode=m.$airlineCode,u.flightNumber=m.$flightNumber,u.airlineName=p[0].tagContents().innerCapture(r.airlineName,1),0===u.airlineName.toString().length&&(u.airlineName="WestJet"),ASSERT(u.departureAirport,u.arrivalAirport,u.departureTime,u.arrivalTime,u.airlineCode,u.flightNumber)&&C.push(u));v=v.nextTag("table1")}while(!r.stopLegsGroup.test(v.tagContents().toString()));for(h="Confirmed",o=0;o<C.length;o++){u=C[o];for(var N=0;N<d.length;N++){var S=(s=d[N]).seatInfo[o].innerCapture(/.*:\s([A-Z0-9-]*)/,1);T.push({"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:u.airlineName,airlineCode:u.airlineCode,flightNumber:u.flightNumber,departureAirportFuzzy:u.departureAirport,departureTime:u.departureTime,arrivalAirportFuzzy:u.arrivalAirport,arrivalTime:u.arrivalTime},underName:{"@type":"http://schema.org/Person",name:s.name},checkinUrl:null,reservationId:a,reservationStatus:"http://schema.org/Reservation"+h,totalPrice:i,priceCurrency:l,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:s.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:S}}})}}if(T.length)return T}}).call();