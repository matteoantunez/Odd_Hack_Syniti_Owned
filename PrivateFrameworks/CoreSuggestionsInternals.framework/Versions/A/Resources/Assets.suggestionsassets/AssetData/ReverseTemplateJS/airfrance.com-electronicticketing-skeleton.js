(function(){return function(e,t,r){var a,n,i,g,m,o,p,s,l,x,d,T,h,u,b,c,f=[],C=Scanner.fromMessage(e),N=[];C.setLocale(t);var v,S,y,F,L,k;for(x=(S=(v=C.getSpan().nextTag("table1")).nextTag("tr1").nextTag("tr1")).next(r.reservationIdLabel).parentTag("td1").tagContents().innerCapture(/([A-Z0-9]{5,})/,1),S=v.nextText(r.passengerCellTitle).nextTag("tr1");S!==C.getNullSpan()&&-1===S.nextTag("td1").toString().indexOf(r.fromLabel);){var A={},E=S.allInnerTags("td1");if(S=S.nextTag("tr1"),!(E.length<2)){A.ticketNumber=E[1].tagContents().trim(),A.name=E[0].tagContents();var z=C.getSpan().nextText(r.id);z.exists()&&E.length>=4&&(A.membershipNumber=E[2].tagContents().trim(),A.programName=z.nextTag("td1").tagContents()),f.push(A)}}for(S=S.nextText(r.fromLabel).parentTag("tr1");S!==C.getNullSpan();){g=(y=S.nextTag("td1")).tagContents().innerCapture(regExpFormatted(/\1\s*([\w \.\-]*)/,r.fromLabel),1).trim(),p=(y=y.nextTag("td1")).innerCapture(regExpFormatted(/\1\s*([\w \.\-]*)/,r.toLabel),1).trim(),(F=(y=y.nextTag("td1")).tagContents().innerCapture(regExpFormatted(/\1\s+($<airlineCode>\w{2})($<flightNumber>\w+)\s+/,r.flight)))&&(n=F.$airlineCode,i=F.$flightNumber),a="",-1!==y.nextTag("td1").nextTag("td1").toString().indexOf(r.codeshareLabel)&&(a=y.nextTag("td1").nextTag("td1").innerCapture(regExpFormatted(/\1\s+([^\[]*).*$/,r.codeshareLabel),1).trim()),(b=(o=y.nextText(r.departureTimeLabel).nextDate()).split(", "))&&2===b.length&&(L=b[0]),u=y.nextText(r["class"]).parentTag("td1").innerCapture(regExpFormatted(/\1\s+([^\[]*).*$/,r["class"]),1).trim(),h=y.next(r.seatNumber).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1\s+(.*)\s+\2/,r.seatNumber,r["class"]),1);var $=0;if(l=y.nextText(r.arrivalTimeLabel).nextDate(),-1!==y.nextText(r.arrivalTimeLabel).parentTag("td1").toString().indexOf("+1")&&($=1),c=l.split(", ")){if(1===c.length&&L)k=c[0],l=C.getDetachedSpan(L.toString()+" "+k.toString()).innerDate(),l=modifyDate(l,$)}else l=null;if(ASSERT(n,i,o,g,l,p))for(A=0;A<f.length;A++){var D=f[A],w={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:a,airlineCode:n,flightNumber:i,departureAirportFuzzy:g,departureAirportCode:m,departureTime:o,arrivalAirportFuzzy:p,arrivalAirportCode:s,arrivalTime:l},underName:{"@type":"http://schema.org/Person",name:D.name},checkinUrl:"",reservationId:x,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:d,priceCurrency:T,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:D.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatingType:u,seatNumber:h}}};valid(OR(D.membershipNumber,D.programName))&&(w.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:D.membershipNumber,programName:D.programName}),N.push(w)}S=S.nextTag("tr1").nextText(r.fromLabel).parentTag("tr1")}if(N.length)return N}}).call();