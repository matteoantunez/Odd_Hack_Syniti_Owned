(function(){return function(e,r,t){if(int(e.epoch)<1356998400)return CONTINUE;var a,n,i=Scanner.fromMessage(e);i.setLocale(r);var p,o,l,s,g,m,u,d,c,h,v,T,f,b,y,N,C,S=[],A={};n=i.getSpan().innerCapture(regExpFormatted(/\1\s+(.*)\s/,t.bookingReference),1);var x=i.getSpan().next(t.totalNewFare).nextAnyTag("td"),F=/(\w+)\s*((?:\d+,{0,})+\.?\d{0,})/;"fr_FR"===r&&(F=/(\D+)\s((?:\d+,{0,}\s?,?)+\.?\d{0,})/),x.isNullSpan_?(N=(d=i.getSpan().next(t.payment).next(t.fare).nextAnyTag("td").tagContents()).replace(F,"$2"),C=d.replace(F,"$1")):(C=(x=x.tagContents()).replace(F,"$1"),N=x.replace(F,"$2"),d="null"),/Votre r\xe9servation/.test(e.subject)&&(d=i.getSpan().next(t.payment).parentAnyTag("td").next(t.fare).parentAnyTag("td").tagContents(),t.fare.test(/Total/)&&(F=/Total\s*(\D+)(\d+\s*\d+\s*(?:\d+,?)+)/),C=d.replace(F,"$1"),N=d.replace(F,"$2")),o=i.getSpan().nextText(t.passengers).nextTag("table4").allInnerTags("tr4").map(function(e){return e.allInnerTagsFiltered("td4")}).filter(function(e){return e.length>=3});for(var $=0;$<o.length;$++){A[(p=(c=o[$])[0]).toString()]={name:p,seats:{},seatingType:{},programName:"Frequent Flyer",membershipNumber:c[1].toString()!==t.NA&&c[1]||null,totalPrice:N,priceCurrency:C},s=c[c.length>3?3:2].split("\n");for(var D,k=0;k<s.length;k++)l=(D=s[k].split("/ "))[1]&&D[1].innerCapture(/(\d+[A-Z])/,1),valid(l)&&(A[p.toString()].seats[D[0].toString()]=l)}m=i.getSpan().nextText(t.itineraryDetails).nextTag("table4").allInnerTags("tr4");for(var z=1;z<m.length;z++){var I=m[z].allInnerTagsFiltered("td4");g=I[0],v=(h=I[1].innerCapture(/($<code>\D+)($<flightNumber>\d+)/))?h.$code:null,u=h?h.$flightNumber:null,f=I[3].innerCapture(/([A-Z]{3}) </,1),T=combineDateAndTime(g,I[3].innerDate()),y=I[4].innerCapture(/([A-Z]{3}) </,1),I[4].innerCapture(/(\+1)$/,1).exists()&&(g=modifyDate(g,1)),b=combineDateAndTime(g,I[4].innerDate());var P=I[I.length-1];if(valid(u,P)){o=Object.keys(A);for($=0;$<o.length;$++)A[o[$].toString()].seatingType[u.toString()]=P}ASSERT(v,u,T,f,b,y)&&S.push({airlineCode:v,flightNumber:u,departureTime:T,departureCode:f,arrivalTime:b,arrivalCode:y,passengers:A})}for(var R=[],j=0;j<S.length;j++)for(var E=S[j],M=Object.keys(E.passengers),O=0;O<M.length;O++){var Z=E.passengers[M[O]],w={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:E.airlineName,airlineCode:E.airlineCode,flightNumber:E.flightNumber,departureAirportFuzzy:E.departureAirport,departureAirportCode:E.departureCode,departureTime:E.departureTime,arrivalAirportFuzzy:E.arrivalAirport,arrivalAirportCode:E.arrivalCode,arrivalTime:E.arrivalTime},underName:{"@type":"http://schema.org/Person",name:Z.name},reservationId:n,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:Z.totalPrice,priceCurrency:Z.priceCurrency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:a,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:Z.seats[E.airlineCode.toString()+E.flightNumber.toString()],seatingType:Z.seatingType[E.flightNumber]}}};valid(Z.membershipNumber,Z.programName)&&(w.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:Z.membershipNumber,programName:Z.programName}),R.push(w)}return R.length?R:void 0}}).call();