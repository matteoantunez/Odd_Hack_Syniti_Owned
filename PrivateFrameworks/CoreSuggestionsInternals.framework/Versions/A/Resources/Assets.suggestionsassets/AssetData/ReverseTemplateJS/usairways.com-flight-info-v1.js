(function(){return function(e,t){var r,a,n=Scanner.fromMessage(e);n.setLocale(t);var i,o,p,g,m,s,l,u,c,d,h,T,f,C,v,y,b=[],S={};r=n.getSpan().nextRegExp(/[Cc]onfirmation code:/).parentAnyTag("td").tagContents().innerCapture(/\b[Cc]onfirmation code:\s+(\w+)/,1),not(r)&&(r=n.getSpan().nextRegExp(/Confirmation code:/).nextAnyTag("td").tagContents()),o=n.getSpan().nextText("Passenger name").parentTag("table3").withStart(n.getSpan().nextText("Passenger name").getEnd()).allInnerTags("tr3"),l=n.getSpan().nextText("Total fare").nextTag("td3").tagContents().innerCapture(/([\d,.]+)/,1),not(l)&&(l=(c=n.getSpan().nextText("Fare total").nextTag("td4").tagContents().innerCapture(/($<total>[\d,.]+)\s+($<currency>[\w]+)/))?c.$total:null,u=c?c.$currency:null);for(var x=0,N=o.length;x<N;x++)S[i=(d=o[x].allInnerTags("td3").map(function(e){return e.tagContents()}))[0].toString()]={name:i,programName:"Frequent Flyer",membershipNumber:d[1],ticketNumber:d[2],seats:{},seatingType:{},totalPrice:l,priceCurrency:u};m=n.getSpan().nextText("Trip details").parentTag("table3").allInnerTags("tr3").map(function(e){return e.allInnerTags("td3").map(function(e){return e.tagContents()})}).filter(function(e){return e.length>0});for(var A,$=/^($<time>\d{1,2}:\d{2} [A|P]M)\s+($<code>[A-Z]{3})$/,F=/Flight # (\d+) : Arrives next day,/,k=0;k<m.length;k++)if((d=m[k])[0].innerCapture(/^(?:Depart|Return)/))g=d[0].nextText("Date:").nextDate();else if(d[1]&&d[1].innerCapture($)){s=d[0],h=d[1].innerCapture($),T=n.getDetachedSpan(g.toString()+" "+h.$time.toString()).innerDate(),f=h.$code,C=d[2].innerCapture($),v=n.getDetachedSpan(g.toString()+" "+C.$time.toString()).innerDate(),y=C.$code;var D=d[d.length-2];p=d[d.length-1].split(" "),o=Object.keys(S);for(x=0;x<Math.min(o.length,p.length);x++)S[o[x]].seats[s]=p[x].trim(),S[o[x]].seatingType[s]=D;ASSERT(s,T,f,v,y)&&b.push({airlineCode:"US",flightNumber:s,reservationId:r,departureCode:f,departureTime:T,arrivalCode:y,arrivalTime:v,passengers:S})}else if(d[0].innerCapture(F)){A=d[0].innerCapture(F,1);for(var P=b.length;P-- >0&&(b[P].arrivalTime=modifyDate(b[P].arrivalTime,1),b[P].flightNumber.toString()!==A.toString());)b[P].departureTime=modifyDate(b[P].departureTime,1)}var z=[];for(k=0;k<b.length;k++)for(var I=b[k],R=Object.keys(I.passengers),M=0;M<R.length;M++){var E=I.passengers[R[M]],U={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:I.airlineName,airlineCode:I.airlineCode||"US",flightNumber:I.flightNumber,departureAirportFuzzy:I.departureAirport,departureAirportCode:I.departureCode,departureTime:I.departureTime,arrivalAirportFuzzy:I.arrivalAirport,arrivalAirportCode:I.arrivalCode,arrivalTime:I.arrivalTime},underName:{"@type":"http://schema.org/Person",name:E.name,email:E.email},checkinUrl:a,reservationId:r,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:E.totalPrice,priceCurrency:E.priceCurrency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:E.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:E.seats[I.flightNumber],seatingType:E.seatingType[I.flightNumber]}}};valid(E.membershipNumber,E.programName)&&(U.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:E.membershipNumber,programName:E.programName}),z.push(U)}if(z.length)return z}}).call();