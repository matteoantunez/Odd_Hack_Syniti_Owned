(function(){return function(e,t,r){var a,n,i,o,p,s,g,m,l,d,h,c,u,v,T,C,y,f,S=Scanner.fromMessage(e);S.setLocale(t);var x=[],A=[],N=[],b=[];f=S.getSpan().next(r.contactPerson).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1\s+(.*)/,r.contactPerson),1);var k=S.getSpan().next(r.flightReservationId).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1\s+(.*)/,r.flightReservationId),1);for(k.toString()||(k=S.getSpan().next(r.itineraryNumber).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1\s+(.*)/,r.itineraryNumber),1)),T=S.getSpan().next(r.passengers).parentAnyTag("table"),y=/table(\d)/.exec(T.toString())[1],l=S.getSpan().next(r.passengers).parentAnyTag("table").allInnerTags("tr"+y),a=1;a<l.length;a++)l[a].allInnerTags("td"+y).length>2&&((d={}).name=l[a].nextAnyTag("td").tagContents(),N.push(d));for(0===N.length&&(C=S.getSpan().next(r.traveller).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1\s+(.*)/,r.traveller),1),N.push({name:C})),i=S.getSpan().next(r.flightSummary).nextAnyTag("table").allInnerCapture(r.departure,0),a=0;a<i.length;a++)v={},p=(o=i[a]).previousAnyTag("td").previousAnyTag("td").tagContents().toString().replace(/-/g," ")||p,s=o.parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/($<departureAirport>.*)\s+\(($<departureCode>.*)\)\s+\1\s+($<departureTime>.*)/,r.departure)),v.departureAirport=s.$departureAirport,v.departureCode=s.$departureCode,v.departureTime=S.getDetachedSpan(p.toString()+" "+s.$departureTime.toString()).innerDate(),g=o.next(r.arrival).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/($<arrivalAirport>.*)\s+\(($<arrivalCode>.*)\)\s+\1\s+($<arrivalTime>.*)/,r.arrival)),v.arrivalAirport=g.$arrivalAirport,v.arrivalCode=g.$arrivalCode,v.arrivalTime=S.getDetachedSpan(p.toString()+" "+g.$arrivalTime.toString()).innerDate(),m=o.next(r.flight).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/($<airlineCode>\w{2})?\s?($<airline>.*)\s+\1\s+($<flightNr>\d+)/,r.flight)),v.airlineName=m.$airline,v.airlineCode=m.$airlineCode,v.flightNumber=m.$flightNr,v.seatingType=m.$flightNr.nextAnyTag("td").nextAnyTag("td").tagContents(),ASSERT(v.airlineName,v.flightNumber,v.arrivalTime,v.departureTime,v.arrivalAirport,v.departureAirport)&&A.push(v);for(h=S.getSpan().next(r.carSummary).parentTag("table3").allInnerCapture(r.carPickup,0),a=0;a<h.length;a++)(c={}).pickupTime=(u=h[a]).parentAnyTag("td").tagContents().innerDate(),c.dropoffTime=u.next(r.carDropoff).parentAnyTag("td").tagContents().innerDate(),c.pickupAddress=c.dropoffAddress=u.next(r.carLocation).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1\s+(.*)/,r.carLocation),1),c.reservationId=u.next(r.carReservationId).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1\s+(.*)/,r.carReservationId),1),c.provider=u.parentTag("td4").tagContents().innerCapture(/(.*)\:/,1),c.name=f,ASSERT(c.name,c.provider,c.dropoffTime,c.pickupTime)&&b.push(c);var $=[];if(!S.getSpan().next(r.hotelSum).isNullSpan_){var R={},F=S.getSpan().next(r.hotelSum).next(r.hotelCheckIn).nextDate(),I=S.getSpan().next(r.hotelSum).next(r.hotelCheckOut).nextDate(),P=S.getSpan().next(r.hotelSum).nextAddress().split("\n").join(" "),D=S.getSpan().next(r.hotelSum).next(r.hotelContact).parentAnyTag("td").tagContents().split("\n")[1].trim(),E=S.getSpan().next(r.hotelSum).nextPhoneNumber(),U=S.getSpan().next(r.hotelSum).nextDate().nextAnyTag("table").nextAnyTag("td").tagContents();ASSERT(F,I)&&(R.checkInDateTime=F,R.checkOutDateTime=I,R.hotelAddress=P,R.hotelNumber=E,R.name=D,R.hotelName=U,$.push(R))}for(a=0;a<A.length;a++){v=A[a];for(var z=0;z<N.length;z++){var L=N[z];n={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:v.airlineName,airlineCode:v.airlineCode,flightNumber:v.flightNumber,departureAirportFuzzy:v.departureAirport,departureAirportCode:v.departureCode,departureTime:v.departureTime,arrivalAirportFuzzy:v.arrivalAirport,arrivalAirportCode:v.arrivalCode,arrivalTime:v.arrivalTime},underName:{"@type":"http://schema.org/Person",name:L.name},checkinUrl:v.checkinUrl,reservationId:k,reservationStatus:"http://schema.org/Reservation"+(v.reservationStatus||"Confirmed"),totalPrice:L.totalPrice,priceCurrency:L.priceCurrency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:L.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:v.seats,seatingType:v.seatingType}}},valid(L.membershipNumber,L.programName)&&(n.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:L.membershipNumber,programName:L.programName}),x.push(n)}}for(a=0;a<b.length;a++)n={"@context":"http://schema.org","@type":"http://schema.org/RentalCarReservation",totalPrice:(c=b[a]).totalPrice,priceCurrency:c.priceCurrency,reservationId:c.reservationId,reservationStatus:"http://schema.org/Reservation"+(c.reservationStatus||"Confirmed"),checkinUrl:c.checkinUrl,modifyReservationUrl:c.modifyReservationUrl,cancelReservationUrl:c.cancelReservationUrl,underName:{"@type":"http://schema.org/Person",name:c.name,email:c.email},provider:{"@type":"http://schema.org/Organization",name:c.provider},pickupTime:c.pickupTime,pickupLocation:{"@type":"http://schema.org/Place",name:c.pickupName,telephone:c.pickupTelephone,address:c.pickupAddress},dropoffTime:c.dropoffTime,dropoffLocation:{"@type":"http://schema.org/Place",name:c.dropoffName,telephone:c.dropoffTelephone,address:c.dropoffAddress}},c.brand&&(n.reservationFor={"@type":"http://schema.org/Car",brand:{"@type":"http://schema.org/Organization",name:c.brand},license:c.license,color:c.color}),x.push(n);for(a=0;a<$.length;a++){var O=$[a];x.push(n={"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:O.name},checkinTime:O.checkInDateTime,checkoutTime:O.checkOutDateTime,reservationStatus:"http://schema.org/ReservationConfirmed",reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:O.hotelName,telephone:O.hotelPhone,address:O.hotelAddress}})}if(x.length)return x}}).call();