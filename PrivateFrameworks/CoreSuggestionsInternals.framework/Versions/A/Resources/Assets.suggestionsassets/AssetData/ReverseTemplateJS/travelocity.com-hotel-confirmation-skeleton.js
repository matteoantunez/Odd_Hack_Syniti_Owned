(function(){return function(e,t,n){var r,a,i,o,s,g,p,d,x,c,l,T,h=Scanner.fromMessage(e);h.setLocale(t),r=h.getSpan().nextText(n.underPersonNamePrefix).nextAnyTag("td").nextAnyTag("td").tagContents().innerCapture(/(.*)\n/,1),a=e.to&&e.to.toString(),p=h.getSpan().innerCapture(regExpFormatted(/\1\s+?(\d+)\s+?/,n.reservationIdPrefix),1);var m=h.getSpan().nextText(n.reservationIdPrefix);i=(m=m.parentAnyTag("table").innerDate().exists()?m.parentAnyTag("table"):m.nextDate().parentAnyTag("table")).nextAnyTag("td").tagContents().innerCapture(/([^\,]+)/,1),m=m.nextAnyTag("td").nextAnyTag("td").tagContents(),l=h.getSpan().innerCapture(regExpFormatted(/(\1\s+.*)/,n.checkInTime),1).innerDate();var u=h.getDateDD(m.innerDate());if(u&&u.iso8601&&u.endIso8601)d=combineDateAndTime(u.iso8601,l),x=u.endIso8601;else{var S=m.innerCapture(/(?:[a-zA-Z]{3})?(.*) - (?:[a-zA-Z]{3})?(.+?)\s[\,|\s]/);d=h.getDetachedSpan(S[1].toString().replace(/\//g," ")+" "+l.toString()).innerDate(),x=h.getDetachedSpan(S[2].toString().replace(/\//g," ")).innerDate()}g=h.getSpan().nextText(n.hotelAddressPrefix).nextLink(),s=h.getSpan().nextText(n.hotelAddressPrefix).nextAddress(),o=h.getSpan().nextText(n.hotelAddressPrefix).nextPhoneNumber().toString().replace(n.phonePrefix,"").trim();var A=h.getSpan().nextText(n.totalPricePrefix).parentAnyTag("td").tagContents();A.innerCapture(/(\d+)/,1).exists()||(A=A.nextAnyTag("td").tagContents()),T=A.innerCapture(/(.)\d+/,1),c=A.innerCapture(/([\d,.]+)/,1);var C=n.cancelled.test(e.plain)?"Cancelled":"Confirmed";return ASSERT(OR(r,a),s,d)?[{"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:r,email:a},totalPrice:c,priceCurrency:T,checkinTime:d,checkoutTime:x,reservationStatus:"http://schema.org/Reservation"+C,reservationId:p,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:i,telephone:o,url:g,address:s}}]:CONTINUE}}).call();