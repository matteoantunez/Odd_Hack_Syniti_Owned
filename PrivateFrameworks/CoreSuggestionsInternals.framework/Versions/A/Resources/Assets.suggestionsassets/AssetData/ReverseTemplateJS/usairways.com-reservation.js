(function(){return function(e,t,r){var a,n,i=Scanner.fromMessage(e);i.setLocale(t);var s,g,m,o,p,l,d,u,h,c,x,T,C,y,b,f,v,N,A,S,$,D=[],F={};a=i.getSpan().next(r.reservationId).parentAnyTag("td").tagContents().innerCapture(/(\w+)\s*$/,1),g=i.getSpan().nextText(r.passenger).nextTag("table2").allInnerTags("tr2").map(function(e){return e.allInnerTagsFiltered("td2")}).filter(function(e){if(!r.namesRegexExcludePassengerText.test(e)&&!r.namesRegexExcludeContactText.test(e)&&!r.namesRegexExcludeEmailText.test(e)&&!r.namesRegexExcludeMembershipText.test(e)&&e.length>0)return e}),o=(l=i.getSpan().next(r.totalPrice).nextTag("td3").tagContents()).innerCapture(/([\d,.\s]+)/,1).trim(),p=l.innerCapture(/([^\d,.\s]+)/,1).trim(),i.getSpan().next(r.membership).exists()&&""!==(y=i.getSpan().nextText(r.membership).nextTag("td3").tagContents())&&(f=y.innerCapture(/(\w+)\s\d+/,1),b=y.innerCapture(/\w+\s(\d+)/,1));for(var P=0,E=g.length;P<E;P++)F[s=(d=g[P])[0].toString()]={name:s,programName:f,membershipNumber:b,ticketNumber:d[2],seats:{},seatingType:{},totalPrice:o,priceCurrency:p};for(S=i.getSpan().allInnerCapture(regExpFormatted(/(\1\s*\d+)/,r.flight),1),k=0;k<S.length;k++)v=(z=S[k]).nextAnyTag("td").tagContents().innerCapture(r.date),A="ja_JP"===t?v.$date.toString()+"-"+v.$month.toString()+"-"+v.$year.toString():v.$date.toString()+" "+v.$month.toString()+" "+v.$year.toString(),v=N=i.getDetachedSpan(A).innerDate(),h=($=(C=(T=(x=(c=z.next(r.departure).nextAnyTag("td").tagContents()).nextAnyTag("td").tagContents()).next(r.arrival).nextAnyTag("td").tagContents()).nextAnyTag("td").tagContents()).next(r.flightInfo).nextAnyTag("td").tagContents().innerCapture(/($<airlineName>\w.*)\s+($<airlineCode>\D+)($<flightNumber>\d+)/)).$airlineCode,m=$.$flightNumber,u=$.$airlineName,C.next(r.seatingType).nextAnyTag("td").tagContents(),c=combineDateAndTime(v,c),T.inner(r.overnight).exists()?(T=combineDateAndTime(N,T.innerDate()),T=modifyDate(T,1,0,0,0)):T=combineDateAndTime(N,T),ASSERT(m,c,x,T,C)&&(0===u.length&&(u="US Airways"),D.push({airlineName:u,airlineCode:h,flightNumber:m,departureAirport:x,departureTime:c,arrivalAirport:C,arrivalTime:T,passengers:F}));for(var R=[],k=0;k<D.length;k++)for(var z=D[k],I=Object.keys(z.passengers),w=0;w<I.length;w++){var M=z.passengers[I[w]],U={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:z.airlineName,airlineCode:z.airlineCode,flightNumber:z.flightNumber,departureAirportFuzzy:z.departureAirport,departureAirportCode:z.departureCode,departureTime:z.departureTime,arrivalAirportFuzzy:z.arrivalAirport,arrivalAirportCode:z.arrivalCode,arrivalTime:z.arrivalTime},underName:{"@type":"http://schema.org/Person",name:M.name,email:M.email},checkinUrl:n,reservationId:a,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:M.totalPrice,priceCurrency:M.priceCurrency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:M.seats[z.flightNumber],seatingType:M.seatingType[z.flightNumber]}}};M.membershipNumber&&M.programName&&(U.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:M.membershipNumber,programName:M.programName}),R.push(U)}if(R.length)return R}}).call();