(function(){return function(e,r,t){var a,i,n,p,o,m,s,u,g,l,d,h,c,v,C,N,b,S=Scanner.fromMessage(e);S.setLocale(r);var f=[],y=[];if(a=S.getSpan().innerCapture(t.name,1).trim(),d=S.getSpan().innerCapture(regExpFormatted(/\1\s+(.*)/,t.ticketNumber),1),C=S.getSpan().innerCapture(regExpFormatted(/\1\s+([A-Z\d]{5,})/,t.reservationId),1),not(a))return CONTINUE;y[a.toString()]={name:a,seats:{},seatingType:{},ticketNumber:d,totalPrice:h,priceCurrency:c},N=S.getSpan().allInnerCapture(t.flightInfo);for(var T=0;T<N.length;T++){if(b=N[T],1===N.length){var A=/(\w{3})\s(\w{3})$/.exec(e.subject);s=A[1],l=A[2]}o=S.getDetachedSpan(b.$departureDate.toString()+" "+b.$departureHour.toString()+":"+b.$departureMinute.toString()).innerDate(),u=S.getDetachedSpan(b.$arrivalDate.toString()+" "+b.$arrivalHour.toString()+":"+b.$arrivalMinute.toString()).innerDate(),p=b.$airlineCode,i=b.$flightNumber,m=b.$departureAirport,g=b.$arrivalAirport,h=(n=S.getSpan().innerCapture(regExpFormatted(/\1\s+(.*)/,t.price),1)).innerCapture(/([\d,.]+)/,1),c=n.innerCapture(/([^\d,.]+)/,1).trim(),ASSERT(p,i,m,o,g,u)&&f.push({reservationId:C,airlineCode:p,flightNumber:i,departureAirport:m,departureCode:s,arrivalCode:l,departureTime:o,arrivalAirport:g,arrivalTime:u,passengers:y})}var $=[];for(T=0;T<f.length;T++)for(var F=f[T],k=Object.keys(F.passengers),I=0;I<k.length;I++){var z=F.passengers[k[I]],D={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:F.airlineName,airlineCode:F.airlineCode,flightNumber:F.flightNumber,departureAirportFuzzy:F.departureAirport,departureAirportCode:F.departureCode,departureTime:F.departureTime,arrivalAirportFuzzy:F.arrivalAirport,arrivalAirportCode:F.arrivalCode,arrivalTime:F.arrivalTime},underName:{"@type":"http://schema.org/Person",name:z.name},checkinUrl:v,reservationId:F.reservationId,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:h,priceCurrency:c,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:d,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:z.seats[F.flightNumber],seatingType:z.seatingType[F.flightNumber]}}};valid(z.membershipNumber,z.programName)&&(D.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:z.membershipNumber,programName:z.programName}),$.push(D)}return $.length?$:void 0}}).call();