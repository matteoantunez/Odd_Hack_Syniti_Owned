(function(){return function(e,t,n){var a,r,i,o,g,s,c,p,m,l,u,x,d,h,C,T,S,f=Scanner.fromMessage(e);if(f.setLocale(t),/(Bus|Event|Flight|FoodEstablishment|Lodging|RentalCar|Train)Reservation/.test(e.html))return CONTINUE;if(!n.emailTitelConfirmation.test(e.subject)&&!n.emailTitelCancelConfirmation.test(e.subject))return CONTINUE;o=f.getSpan().innerCapture(n.reservationId,1),a=f.getSpan().nextRegExp(n.guestName).nextAnyTag("td").tagContents(),c=f.getSpan().nextRegExp(n.checkInDate).nextAnyTag("td").tagContents(),s=f.getSpan().nextRegExp(n.checkInTime).nextAnyTag("td").tagContents().innerDate(),l=f.getSpan().nextRegExp(n.checkOutDate).nextAnyTag("td").tagContents(),m=f.getSpan().nextRegExp(n.checkOutTime).nextAnyTag("td").tagContents().innerDate(),l=modifyDate(c,l,0,0,0),p=getFuzzyDate(f.getDetachedSpan(c+" "+s).innerDate()),u=getFuzzyDate(f.getDetachedSpan(l+" "+m).innerDate());var E=f.getSpan().nextRegExp(n.price).nextAnyTag("td").tagContents();r=E.innerCapture(/([\d,.]+)/,1),i=E.innerCapture(/([^\d,.]+)/,1).trim(),d=f.getSpan().nextRegExp(n.hotelName).nextAnyTag("td").tagContents();var R=f.getSpan().nextRegExp(n.hotelInfo).parentAnyTag("td").tagContents();if(C=R.innerCapture(regExpFormatted(/.+\n.+\n([\s\S]*)\1/,n.hotelPhone),1),h=R.innerPhoneNumber(),S=f.getSpan().nextRegExp(n.cancelUrl).nextLink(),n.emailTitelConfirmation.test(e.subject)){if(!ASSERT(a,o,p,u,d))return CONTINUE;g="Confirmed"}if(n.emailTitelCancelConfirmation.test(e.subject)){if(!ASSERT(a,o,p,u,d))return CONTINUE;g="Cancelled"}return[{"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:a},totalPrice:r,priceCurrency:i,checkinTime:p,checkoutTime:u,modifyReservationUrl:T,cancelReservationUrl:S,reservationStatus:"http://schema.org/Reservation"+(g||"Confirmed"),reservationId:o,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:d,url:x,telephone:h,address:C}}]}}).call();