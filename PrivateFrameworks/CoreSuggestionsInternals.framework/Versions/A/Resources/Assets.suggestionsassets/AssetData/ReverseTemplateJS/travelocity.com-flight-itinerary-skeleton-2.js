(function(){return function(e,r,t){if(!e||!r||!t)return CONTINUE;var a,n,i,o,p,s,l,d,u,g=Scanner.fromMessage(e);g.setLocale(r);var v=[],m=[],T=/\s\((\w{3})\)/;for(a=g.getSpan().next(t.reservationId).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1\s+(\d+)/,t.reservationId),1),n=g.getSpan().allInnerCapture(t.cabin,1),c=0;c<n.length;c++){l={},o=(u=n[c]).previousDate();var C=!1;/\s*\d?\d:\d\d\s*(?:am|pm)?/i.test(o)||(o=u.previousDate().previousDate());var h=u.previousDate().previousDate().parentAnyTag("td").tagContents();/\+1 day/.test(h)&&(C=!0),l.arrivalCode=o.previousAnyTag("tr").innerCapture(T,1),l.arrivalCode.isNullSpan_&&(l.arrivalCode=o.previousAnyTag("tr").previousAnyTag("tr").previousAnyTag("tr").innerCapture(T,1)),i=o.previousDate(),/\+1 day/.test(i)&&(i=i.replace(/(.*)\s\+1 day.*/,"$1")),l.departureCode=i.previousAnyTag("td").innerCapture(T,1),d=i.previousTag("td6").tagContents().innerCapture(/($<airline>.*)\s($<flightNumber>\d+)/),l.airlineName=d?d.$airline:null,l.flightNumber=d?d.$flightNumber:null,l.departureAirport=u.parentAnyTag("td").previousAnyTag("td").nextTag("table8").tagContents().innerCapture(/([^\n]+)\s/,1).trim(),l.arrivalAirport=u.parentAnyTag("td").previousAnyTag("td").nextTag("table8").nextTag("table8").tagContents().innerCapture(/([^\n]+)\s/,1).trim(),l.airlineCode=u.parentAnyTag("td").previousAnyTag("td").previousAnyTag("td").tagContents().innerCapture(/([^\n\d]+)\s/,1),l.airlineCode=loadHelper("icaoCodeToIataCode.js")(l.airlineCode),l.airlineName.previousAnyTag("td").innerCapture(t.date,1).exists()&&(p=l.airlineName.previousAnyTag("td").innerDate()),l.departureTime=combineDateAndTime(p,i),l.arrivalTime=C?modifyDate(combineDateAndTime(p,o),1):combineDateAndTime(p,o),ASSERT(OR(l.departureCode,l.departureAirport),OR(l.arrivalCode,l.arrivalAirport),l.airlineName,l.flightNumber,l.arrivalTime,l.departureTime)&&v.push(l)}for((s=g.getSpan().next(t.passengers).collapseToEnd().withEnd(g.getSpan().next(t.passengerEnd).getStart()).allInnerTags("td6"))!==undefined&&0!==s.length||s.push(g.getSpan().next(t.traveler).nextAnyTag("td").tagContents().innerCapture(/([^\n]+)\s[\n]+/,1).trim()),c=0;c<s.length;c++)N=s[c].tagContents().innerCapture(/(.*)/,1),m.push(N);for(var y=[],c=0;c<v.length;c++){l=v[c];for(var A=0;A<m.length;A++){var N,f={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:l.airlineName,airlineCode:l.airlineCode,flightNumber:l.flightNumber,departureAirportFuzzy:l.departureAirport,departureAirportCode:l.departureCode,departureTime:l.departureTime,arrivalAirportFuzzy:l.arrivalAirport,arrivalAirportCode:l.arrivalCode,arrivalTime:l.arrivalTime},underName:{"@type":"http://schema.org/Person",name:(N=m[A]).trim()},checkinUrl:l.checkinUrl,reservationId:a,reservationStatus:"http://schema.org/Reservation"+(l.reservationStatus||"Confirmed"),totalPrice:null,priceCurrency:null,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:null,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:null,seatingType:l.seatingType}}};y.push(f)}}return y.length?y:void 0}}).call();