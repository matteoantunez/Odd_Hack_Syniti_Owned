(function(){return function(e){function t(e,t){for(var a=0;a<e.length;a++)if(e[a].start_===t.start_&&e[a].end_===t.end_&&e[a].toString()===t.toString())return!0}var a=loadHelper("flight_date_penalty.js"),r=e[0].span.scanner_,n=new Date(1e3*r.epoch_),u=1e3,p=1,s=1,l=[],D=[];return e.forEach(function(e){var D=e.span,_=r.getDetachedSpan(D.parentAnyTag("tr").toString());if(_.end_-_.start_<u){for(var i=_.nextAbsoluteDate(),o=i;t(l,o)&&!o.isNullSpan_;)o=o.nextAbsoluteDate();o.isNullSpan_&&!i.isNullSpan_&&(o=i),o.isNullSpan_||(e.departureDate=unSpanDate_(o),l.push(o))}if(!e.departureDate){var d=D,S=D,f=D.scanner_.getSpan().allAbsoluteDates();if(1===f.length)return void(a(new Date(unSpanDate_(f[0])),n)>=0&&(e.departureDate=unSpanDate_(f[0])));var c=1,v=2;if(d=d.previousAbsoluteDate(),S=S.nextAbsoluteDate(),c=a(new Date(unSpanDate_(d)),n),v=a(new Date(unSpanDate_(S)),n),!d.isNullSpan_&&!S.isNullSpan_){var h=D.start_-d.start_,N=S.start_-D.start_;c+=Math.round(h/N*100)/100,v+=Math.round(N/h*100)/100}d.isNullSpan_&&(c+=10),S.isNullSpan_&&(v+=10),s+=c,p+=v,e.departureDatePrevious=unSpanDate_(d),e.departureDateNext=unSpanDate_(S)}}),e.forEach(function(e){e.departureDate||(e.departureDate=s<=p&&e.departureDatePrevious||s>p&&!e.departureDateNext?e.departureDatePrevious:e.departureDateNext),e.departureDate&&(e.departureDate=e.departureDate.split("T")[0],D.push(e))}),D}}).call();