(function(){return function(e,r,t){if(/(?:Your Delta itinerary has changed|Schedule Changes That Impact)/.test(e.subject)){var a,i,n,p=Scanner.fromMessage(e);p.setLocale(r);var m,s,o,l,g,u,h,d,c,v,N,b,f,T,y=[],C={};for((m=p.getSpan().innerCapture(t.nameExtractor,1)).exists()&&(C[m]={name:m,seats:{},seatingType:{}}),i=p.getSpan().innerCapture(t.confirmationNumber,1),l=p.getSpan().nextText("Updated Itinerary");l.nextText("Flight:").exists();)s=(l=l.nextText("Flight:")).previousDate(),10===(o=l.parentTag("table2").allInnerTagsFiltered("td2")).length&&(g=(u=o[1].innerCapture(/($<airlineName>.*)\s+($<flightNumber>\d+)/))?u.$flightNumber:null,d=/delta/gi.test(h=u?u.$airlineName:null)?"DL":null,(c=o[3].innerCapture(/($<time>\d{1,2}:\d{2} (?:am|pm))\s+from\s+($<airport>.*)/))&&(v=p.getDetachedSpan(s.toString()+" "+c.$time.toString()).innerDate(),N=c.$airport),(b=o[5].innerCapture(/($<time>\d{1,2}:\d{2} (?:am|pm))\s+at\s+($<airport>.*)/))&&(f=p.getDetachedSpan(s.toString()+" "+b.$time.toString()).innerDate(),T=b.$airport),valid(g,C[m])&&(C[m].seats[g]=o[7]),ASSERT(h,g,N,v,T,f)&&y.push({airlineName:h,airlineCode:d,flightNumber:g,departureAirport:N,departureTime:v,arrivalAirport:T,arrivalTime:f,passengers:C}));for(var S=[],$=0;$<y.length;$++)for(var x=y[$],A=Object.keys(x.passengers),F=0;F<A.length;F++){var D=x.passengers[A[F]],k={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:x.airlineName,airlineCode:x.airlineCode,flightNumber:x.flightNumber,departureAirportFuzzy:x.departureAirport,departureAirportCode:x.departureCode,departureTime:x.departureTime,arrivalAirportFuzzy:x.arrivalAirport,arrivalAirportCode:x.arrivalCode,arrivalTime:x.arrivalTime},underName:{"@type":"http://schema.org/Person",name:D.name},checkinUrl:n,reservationId:i,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:D.totalPrice,priceCurrency:D.priceCurrency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:a,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:D.seats[x.flightNumber],seatingType:D.seatingType[x.flightNumber]}}};valid(D.membershipNumber,D.programName)&&(k.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:D.membershipNumber,programName:D.programName}),S.push(k)}if(S.length)return S}}}).call();