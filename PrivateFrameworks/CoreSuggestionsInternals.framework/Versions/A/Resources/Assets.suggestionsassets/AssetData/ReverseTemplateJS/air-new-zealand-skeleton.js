(function(){return function(e,t,r){var a,n,i,s,g,p,o,l,d,m,u,T,h,c,y,A=Scanner.fromMessage(e);A.setLocale(t);var v=[],x=[];for(a=A.getSpan().innerCapture(regExpFormatted(/\1\s+(\w+)/,r.reservationId),1),u=A.getSpan().next(r.itinerary).nextTag("table2");u.inner(r.departure).exists();){for(d={},m=u.nextAnyTag("td").tagContents().innerCapture(/($<departure>.*)\s+-\s+($<arrival>.*)\n\n($<airlineCode>\D{2})($<flightNumber>\d+)/),d.departureAirport=m.$departure,d.arrivalAirport=m.$arrival,d.airlineCode=m.$airlineCode,d.flightNumber=m.$flightNumber,i=(n=(g=(s=u.next(r.duration).nextAnyTag("td").tagContents()).nextAnyTag("td").nextAnyTag("td").tagContents()).nextAnyTag("td").nextAnyTag("td").tagContents()).nextAnyTag("td").tagContents(),d.departureTime=combineDateAndTime(n,s),d.arrivalTime=combineDateAndTime(i,g),d.passengers=[],T=u.next(r.passengers).nextTag("table3").allInnerTags("tr3"),h=0;h<T.length;h++)(y={}).name=T[h].nextAnyTag("td").tagContents(),c=y.name.nextAnyTag("td").tagContents().innerCapture(/($<seat>.*?)\s+($<seatingType>.*)/),y.seat=c.$seat,y.seatingType=c.$seatingType,ASSERT(y.name)&&d.passengers.push(y);u=u.nextTag("table2").nextTag("table2").nextTag("table2"),ASSERT(d.flightNumber,d.airlineCode,d.departureTime,d.arrivalTime,d.departureAirport,d.arrivalAirport)&&v.push(d)}for(h=0;h<v.length;h++){d=v[h];for(var C=0;C<d.passengers.length;C++){x.push({"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:"Air New Zealand",airlineCode:d.airlineCode,flightNumber:d.flightNumber,departureAirportFuzzy:d.departureAirport,departureTime:d.departureTime,arrivalAirportFuzzy:d.arrivalAirport,arrivalTime:d.arrivalTime},underName:{"@type":"http://schema.org/Person",name:(y=d.passengers[C]).name},checkinUrl:l,reservationId:a,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:p,priceCurrency:o,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:y.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:y.seat,seatingType:y.seatingType}}})}}if(x.length)return x}}).call();