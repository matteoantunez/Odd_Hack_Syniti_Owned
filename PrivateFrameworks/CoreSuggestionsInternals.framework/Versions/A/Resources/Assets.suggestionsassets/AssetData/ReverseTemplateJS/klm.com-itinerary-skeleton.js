(function(){return function(e,r,t){var a,i,n,p,o,m,g,s,u,d,l,h,c,v,S,C,N,b,f,y=Scanner.fromMessage(e);y.setLocale(r);var $=[],T=[];if(a=y.getSpan().innerCapture(t.name,1).trim(),l=y.getSpan().innerCapture(regExpFormatted(/\1\s+?(.+)/,t.ticketNumber),1),S=y.getSpan().innerCapture(regExpFormatted(/\1\s+?([A-Z\d]{4,})/,t.reservationId),1),not(a))return CONTINUE;T[a.toString()]={name:a,seats:{},seatingType:{},ticketNumber:l,totalPrice:h,priceCurrency:c};var A=y.getSpan().next(t.contentRegex);C=y.getSpan().allInnerCapture(t.arrival,1);for(var x=0;x<C.length;x++)1===C.length&&(g=(f=/(\w{3})\s(\w{3})$/.exec(e.subject))[1],d=f[2]),N=(b=C[x].withStart(A.getEnd()).withEnd(C[x].previous(/.*/).next(t.flightSectionEnd).getEnd())).innerCapture(t.flightInfo),o=y.getDetachedSpan(N.$departureDate.toString()+" "+N.$departureHour.toString()+":"+N.$departureMinute.toString()).innerDate(),N.$arrivalDate.exists()||(N.$arrivalDate=N.$departureDate),s=y.getDetachedSpan(N.$arrivalDate.toString()+" "+N.$arrivalHour.toString()+":"+N.$arrivalMinute.toString()).innerDate(),p=N.$airlineCode,i=N.$flightNumber,m=N.$departureAirport.trim(),u=N.$arrivalAirport.trim(),h=(n=y.getSpan().innerCapture(regExpFormatted(/\1\s+?(.+)/,t.price),1)).innerCapture(/([\d,.]+)/,1),c=n.innerCapture(/([^\d,.]+)/,1).trim(),A=b,ASSERT(p,i,m,o,u,s)&&$.push({reservationId:S,airlineCode:p,flightNumber:i,departureAirport:m,departureCode:g,departureTime:o,arrivalAirport:u,arrivalCode:d,arrivalTime:s,passengers:T});var D=[];for(x=0;x<$.length;x++)for(var E=$[x],F=Object.keys(E.passengers),k=0;k<F.length;k++){var I=E.passengers[F[k]],z={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:E.airlineName,airlineCode:E.airlineCode,flightNumber:E.flightNumber,departureAirportFuzzy:E.departureAirport,departureAirportCode:E.departureCode,departureTime:E.departureTime,arrivalAirportFuzzy:E.arrivalAirport,arrivalAirportCode:E.arrivalCode,arrivalTime:E.arrivalTime},underName:{"@type":"http://schema.org/Person",name:I.name},checkinUrl:v,reservationId:E.reservationId,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:h,priceCurrency:c,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:l,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:I.seats[E.flightNumber],seatingType:I.seatingType[E.flightNumber]}}};valid(I.membershipNumber,I.programName)&&(z.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:I.membershipNumber,programName:I.programName}),D.push(z)}return D.length?D:void 0}}).call();