(function(){return function(e,t,r){if(!e||!t||!r)return CONTINUE;var a=Scanner.fromMessage(e);a.setLocale(t);for(var n,i,p,m,s,o,g,l,d,h,u,T,x=a.getSpan(),v=[],c=[],C=[],b=new RegExp(r.reservationIdPrefix+"(.+)?"),y=x.nextText(r.reservationIdPrefix).parentAnyTag("td").tagContents().innerCapture(b,1),N=x.next(r.viewTrip).nextDate(),f=[],A=N;A.nextTag("td6").tagContents().toString().length>1;){var F=A.nextTag("table4"),I=F.allInnerTagsFiltered("td6");if(0!==I.length){n=I[0],i=I[1],s=I[2],o=I[3],p=I[4],l=(g=(m=I[5]).nextTag("td5").nextTag("td5").tagContents().innerCapture(/($<name>\D+)\s($<code>\d+)/)).$code,d=g.$name;var k=m.nextText(r.seat).nextAnyTag("td").tagContents();T=k.replace(/<_link_>/g,"").innerCapture(/(^[a-zA-Z0-9,-\s]*)/,1);var D=k.nextText(r.seatType).nextAnyTag("td").tagContents().innerCapture(/(^.+)/,1);u=D.nextText(r.meals).nextAnyTag("td").tagContents(),s=combineDateAndTime(N,s),o=combineDateAndTime(N,o),Date.parse(s)>Date.parse(o)&&(o=modifyDate(o,1)),A=u.nextTag("table4"),ASSERT(n,i,s,o,p,m)&&f.push({departureCode:n,arrivalCode:i,departureTime:s,arrivalTime:o,departureAirport:p,arrivalAirport:m,flightNumber:l,airlineName:d,seat:T,seatType:D,meals:u})}else{if(F.allInnerTagsFiltered("td4").length>0){A=N=F.allInnerTagsFiltered("td4")[0].innerDate();continue}A=F}}var E=u.next(r.membership).parentTag("table4"),S=E.allInnerTagsFiltered("td4"),z=E.allInnerTagsFiltered("td5");if(u.nextText(r.price).exists())for(var R=u,$=0;$<S.length/2;$++){var P=R.nextText(r.price).parentAnyTag("td").nextAnyTag("td").tagContents().innerCapture(/.*\s($<total>\d+(\.\d+)?)/);P&&(v[$]=P.$total);var w=new RegExp(r.fare+"-(.*)");c[$]=R.nextText(r.fare).parentAnyTag("td").tagContents().innerCapture(w,1),R=v[$]}for(var M,U,Z,O=[],_=new RegExp(r.ticket+"\\s#\\s([\\d\\-]+)"),L=0;L<S.length/2;L++){z.length&&(M=z.length===S.length/2?z[L].innerCapture(_,1):z[3*L+2].innerCapture(_,1));var j=S[2*L];S[2*L+1].innerCapture(regExpFormatted(/\1\s\#\s([\dA-Z]+)/,r.membership),1)&&(Z=S[2*L+1].innerCapture(regExpFormatted(/\1\s\#\s([\dA-Z]+)/,r.membership),1),U=r.membership),O.push({name:j,ticketNumber:M,programName:U,membershipNumber:Z})}for(var q=0;q<f.length;q++){var B=f[q];for(L=0;L<O.length;L++){var G=O[L],H=T;S.length/2>1&&(h=B.seat.split(","));var J={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:B.airlineName,flightNumber:B.flightNumber,departureAirportFuzzy:B.departureAirport,departureAirportCode:B.departureCode,departureTime:B.departureTime,arrivalAirportFuzzy:B.arrivalAirport,arrivalAirportCode:B.arrivalCode,arrivalTime:B.arrivalTime},underName:{"@type":"http://schema.org/Person",name:G.name},reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:G.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:(S.length/2>1?h[L]:H).trim(),seatingType:B.seatType}},reservationId:y,totalPrice:v[L],priceCurrency:c[L],reservationStatus:"http://schema.org/ReservationConfirmed"};valid(G.membershipNumber)&&(J.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:G.membershipNumber,programName:G.programName}),C.push(J)}}return C.length?C:CONTINUE}}).call();