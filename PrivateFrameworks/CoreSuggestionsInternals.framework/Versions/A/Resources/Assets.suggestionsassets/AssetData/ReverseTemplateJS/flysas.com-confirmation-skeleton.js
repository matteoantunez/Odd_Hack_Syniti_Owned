(function(){return function(e,t,r){function a(e){return!/\d{1,2}:\d{1,2}\s+-\s+\d{1,2}:\d{1,2}/i.test(e)}function i(e){for(var t=S,i=t.next(r.flightPrefix).nextDate();i.exists()&&a(i.getString())&&!(i.getStart()>e.getStart());)t=i,i=i.next(r.flightPrefix).nextDate();return t}var n=Scanner.fromMessage(e);n.setLocale(t);var p=n.getSpan().getString().match(/\w+\s\(\w+\)/g),o={};p&&p.forEach(function(e){var t=e.split("(");t[1]=t[1].replace(/\)/g,""),o[t[0].trim()]=t[1]});var s,g,u,l,d,m,c,h,x=[],v=[],C=[];g=n.getSpan().innerCapture(regExpFormatted(/\1\s*: (.*)/,r.reference),1).trim(),m=n.getSpan().nextText(r.number).parentTag("td1").tagContents().innerCapture(regExpFormatted(/\1(.*)/,r.number),1).trim(),(u=n.getSpan().nextText(r.total).nextAnyTag("td").tagContents().innerCapture(regExpFormatted(/($<totalPrice>[\d\.,]+)\s+($<priceCurrency>\w{3})/)))&&(l=u.$totalPrice,d=u.$priceCurrency);for(var f=m.split(","),y=n.getSpan().nextText(r.passenger).next(regExpFormatted(/\[td1\]\s*([\w\xe9\xe0\' ]+)\s+\1/i,r.adult)),z=0;y.exists();){var F=y.innerCapture(regExpFormatted(/\]\s*(.*?)\s+\1/i,r.adult),1).trim();v.push({name:F,ticketNumber:f[z].trim()}),z<f.length-1&&z++,y=y.next(regExpFormatted(/\[td1\]\s*([\w\xe9\xe0\' ]+)\s+\1/i,r.adult))}s=n.getSpan().firstTag("table1").allInnerTagsFiltered("tr1");for(var S=n.getSpan().next(r.flightPrefix).nextDate(),T=4;T<s.length;T+=4){h={};var A,b,N=s[T];if((b=N.innerDate()).exists()&&/^\d+/.test(N)){b=b.split("-"),c=s[T+1].withEnd(s[T+1].nextClosingTag("td1").getStart()).innerCapture(/($<airlineCode>\D+)($<flightNumber>\d+)/),h.flightNumber=c.$flightNumber,h.airlineCode=c.$airlineCode,A=i(b[0],N),h.departureTime=getFuzzyDate(n.getDetachedSpan(A+" "+b[0])),h.arrivalTime=getFuzzyDate(n.getDetachedSpan(A+" "+b[1]));var E=s[T+1].next(r.seat).parentAnyTag("td").innerCapture(regExpFormatted(/\1\s:?(.*?)\|/i,r.seat),1);h.seats=E.exists()?E.split(","):Array(10).fill(""),h.bookingClass=s[T+1].next(r.bookingClass).parentAnyTag("td").innerCapture(regExpFormatted(/\1\s*:?(.*?)\|/i,r.bookingClass),1).trim(),h.departureAirportFuzzy=N.innerCapture(/\[td1\](.*)\-/,1).trim(),h.arrivalAirportFuzzy=N.innerCapture(/\[td1\].*\-(.*)/,1).trim();var k=h.departureAirportFuzzy.getString().split(",")[0],D=h.arrivalAirportFuzzy.getString().split(",")[0];h.departureAirportCode=k in o?o[k]:"",h.arrivalAirportCode=D in o?o[D]:"",h.airlineName=s[T+1].innerCapture(regExpFormatted(/\1\s*:(.*)\|/,r.operate),1).trim(),ASSERT(h.flightNumber,h.departureTime,h.arrivalTime,h.departureAirportFuzzy,h.arrivalAirportFuzzy)&&x.push(h)}}for(var $=0;$<x.length;$++){h=x[$];for(var P=0;P<v.length;P++){var w=v[P],R={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:h.airlineName,airlineCode:h.airlineCode,flightNumber:h.flightNumber,departureAirportFuzzy:h.departureAirportFuzzy,departureAirportCode:h.departureAirportCode,departureTime:h.departureTime,arrivalAirportFuzzy:h.arrivalAirportFuzzy,arrivalAirportCode:h.arrivalAirportCode,arrivalTime:h.arrivalTime},underName:{"@type":"http://schema.org/Person",name:w.name},checkinUrl:"",reservationId:g,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:l,priceCurrency:d,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:w.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:h.seats[P].trim(),seatingType:h.bookingClass}}};C.push(R)}}if(C.length)return C}}).call();