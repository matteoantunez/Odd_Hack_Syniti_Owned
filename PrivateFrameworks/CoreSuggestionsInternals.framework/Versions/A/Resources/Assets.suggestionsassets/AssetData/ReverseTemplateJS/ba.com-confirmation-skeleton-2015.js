(function(){return function(e,t,r){var a,n,i,g,o,l,p,s,m,d,u,h,T,x,c,C,S,N,f=Scanner.fromMessage(e);f.setLocale(t);var v=[],y=[],A=[];a=f.getSpan().next(r.reservationId).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1\s*(.*)/,r.reservationId),1),d=(m=f.getSpan().next(r.pricePrefix).nextAnyTag("td").tagContents()).innerCapture(/([\d,.]+)/,1),u=m.innerCapture(/([^\d,.]+)/,1).trim();var b=regExpFormatted(/\1\2/,r.manageBooking,/\s*<[^>]*?>/),F=f.getSpan().next(b).next(r.yourItinerary);for(h=F.withEnd(F.next(r.itineraryEnd).getStart()).allInnerTagsFiltered("td4"),T=0;T<h.length;T++)(c=h[T]).innerDate().exists()&&(x={},n=c.innerCapture(/^($<airlineCode>\D+)($<flightNumber>\d+)/),x.airlineCode=n.$airlineCode,x.flightNumber=n.$flightNumber,C=c.nextAnyTag("td").tagContents().innerCapture(/^($<airlineName>.*)\|.*\|($<status>.*)$/),x.airlineName=C.$airlineName.trim(),x.airlineStatus=C.$status,l=(i=x.airlineName.nextTag("td7").tagContents()).nextTag("td7").nextTag("td7").tagContents(),"ja_JP"===t&&(i=i.toString().replace(/ /g,"-")),x.departureTime=combineDateAndTime(i,l),o=l.nextTag("td7").nextTag("td7").tagContents(),x.departureAirport=(o.toString()+" "+o.nextAnyTag("td").tagContents().toString()).trim(),p=(g=o.nextTag("table7").nextTag("td7").tagContents()).nextTag("td7").nextTag("td7").tagContents(),"ja_JP"===t&&(g=g.toString().replace(/ /g,"-")),x.arrivalTime=combineDateAndTime(g,p),s=p.nextTag("td7").nextTag("td7").tagContents(),x.arrivalAirport=(s.toString()+" "+s.nextAnyTag("td").tagContents().toString()).trim(),ASSERT(x.airlineName,x.airlineCode,x.flightNumber,x.departureTime,x.departureAirport,x.arrivalTime,x.arrivalAirport)&&v.push(x));for(0===(S=f.getSpan().next(r.ticketNumberPrefix).collapseToEnd().withEnd(f.getSpan().next(r.passengerPostFix).getStart()).allInnerTagsFiltered("td5")).length&&r.hasOwnProperty("alternatePassPostFix")&&(S=f.getSpan().next(r.ticketNumberPrefix).collapseToEnd().withEnd(f.getSpan().next(r.alternatePassPostFix).getStart()).allInnerTagsFiltered("td5")),T=0;T<S.length;T++)(N=S[T].tagContents().innerCapture(/($<ticketNumber>.*)\s+\(($<name>.*)\)/))instanceof Array&&N.length&&N.$name.exists()&&A.push({name:N.$name,ticketNumber:N.$ticketNumber});for(0===A.length&&A.push({name:f.getSpan().innerCapture(r.nameCapture,1)}),T=0;T<v.length;T++){x=v[T];for(var $=0;$<A.length;$++){ASSERT(x.airlineName||x.airlineCode,x.flightNumber,x.departureAirport,x.departureTime),y.push({"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:x.airlineName,airlineCode:x.airlineCode,flightNumber:x.flightNumber,departureAirportFuzzy:x.departureAirport,departureTime:x.departureTime,arrivalAirportFuzzy:x.arrivalAirport,arrivalTime:x.arrivalTime},underName:{"@type":"http://schema.org/Person",name:(N=A[$]).name},reservationId:a,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:d,priceCurrency:u,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:N.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat"}}})}}if(y.length)return y}}).call();