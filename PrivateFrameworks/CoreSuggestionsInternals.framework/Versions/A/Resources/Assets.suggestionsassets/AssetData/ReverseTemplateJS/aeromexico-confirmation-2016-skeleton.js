(function(){return function(e,t,r){var a,n,i,p,o,s,g,l,d,m,u,h,T=Scanner.fromMessage(e);T.setLocale(t);var v=[],x=[],c=[];if(/on hold/i.test(e.plain))return CONTINUE;(a=T.getSpan().next(r.reservationId).nextAnyTag("td").tagContents().trim()).toString()||(a=T.getSpan().next(r.reservationIdAlt).nextRegExp(/[A-Z\d]{6}/));for(var A,C,f=T.getSpan().next(r.passengers).next(r.passenger);0!==f.toString().length;)A=f.innerCapture(r.passenger),(l={}).name=A.$name,l.ticketNumber=A.$ticketNumber,ASSERT(l.name)&&(C=!0,v.push(l)),f=f.next(r.passenger);for(m=T.getSpan().next(r.flightDetails).nextTag("table5").parentTag("table4").allInnerTags("table5"),s=0;s<m.length;s++)if(d={},(g=m[s].allInnerTags("td5")).length>4){if(!C)for(var S=g[1].next(r.passengerAlt).parentTag("table6").allInnerTags("td6"),b=0;b<S.length;b++)(l={}).name=S[b].nextTag("td7").tagContents().trim(),l.name.exists()&&(C=!0,v.push(l));u=g[0].innerCapture(r.flightInfo),d.airlineCode=u.$airlineCode,d.flightNumber=u.$flightNumber,n=g[1].innerDate(),i=g[1].next(r.departure).nextTag("td6").innerDate(),d.departureTime=combineDateAndTime(n,i),d.departureAirport=g[1].next(r.departure).nextTag("td6").tagContents().innerCapture(/(.*)\s\n/,1),d.departureAirportCode=/^([A-Z]{3}) .*/.exec(d.departureAirport.toString())[1],p=g[1].next(r.arrival).nextTag("td6").innerDate(),d.arrivalTime=combineDateAndTime(n,p),d.arrivalAirport=g[1].next(r.arrival).nextTag("td6").tagContents().innerCapture(/(.*)\s\n/,1),Date.parse(d.arrivalTime)<Date.parse(d.departureTime)&&(d.arrivalTime=modifyDate(d.arrivalTime,1)),d.arrivalAirportCode=/^([A-Z]{3}) .*/.exec(d.arrivalAirport.toString())[1],d.seatingType=g[1].next(r.seat).nextTag("td7").tagContents().trim(),d.passengers=[];for(var y=0;y<v.length;y++){l={};var N=g[8].allInnerTags("td7"),k=N[3*y+2].innerCapture(/([\dA-Z]{3,4})/,1);l.seat=k;var F=N[3*y].tagContents();l.name=F.replace(/[\u200B-\u200D\uFEFF]/g,"");var D=T.getSpan().next(r.passengers).nextRegExp(regExpFormatted(/\n\1\:\s+\d{10,}\s+<.*?>/,l.name.toString()));l.ticket=D.innerCapture(regExpFormatted(/\n\1\:\s+($<ticketNumber>\d{10,})\s+<($<link>.*?)>/,l.name.toString()),1),d.passengers.push(l)}ASSERT(d.departureAirport,d.arrivalAirport,d.departureTime,d.arrivalTime,d.airlineCode,d.flightNumber)&&x.push(d)}for(h=r.bookingPending?"Pending":"Confirmed",s=0;s<x.length;s++){var I=(d=x[s]).passengers;for(y=0;y<I.length;y++){c.push({"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:"Aero M\xe9xico",airlineCode:d.airlineCode,flightNumber:d.flightNumber,departureAirportFuzzy:d.departureAirport,departureTime:d.departureTime,departureAirportCode:d.departureAirportCode,arrivalAirportFuzzy:d.arrivalAirport,arrivalTime:d.arrivalTime,arrivalAirportCode:d.arrivalAirportCode},underName:{"@type":"http://schema.org/Person",name:(l=I[y]).name},checkinUrl:o,reservationId:a,reservationStatus:"http://schema.org/Reservation"+h,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:l.ticket,ticketedSeat:{"@type":"http://schema.org/Seat",seatingType:d.seatingType,seat:l.seat}}})}}return c.length?c:void 0}}).call();