(function(){return function(e,t,n){var r,a,i,s,o,g,x,c,d,m,h,p,u,l=Scanner.fromMessage(e);if(l.setLocale(t),n.reservationCancelled.test(e.subject))u="Cancelled";else{if(!n.confirmation.test(e.subject))return CONTINUE;u="Confirmed"}var f=l.getSpan().next(n.reservationIdPrefix);x=f.nextTag("td3").tagContents(),r=f.next(n.underPersonNamePrefix).nextTag("td3").tagContents().innerCapture(regExpFormatted(/(.*)\1/,n.underPersonNameSuffix),1).trim(),(i=f.next(n.hotelNamePrefix).nextTag("td3").tagContents()).exists()&&(i=i.toString().replace(/\s*<.+>/,"")),s=f.next(n.hotelPhonePrefix).nextTag("td3").replace(/<_link_>/,"").tagContents(),(g=f.next(n.hotelAddressPrefix).nextTag("td3").tagContents()).exists()&&(g=g.toString().replace(/\s*<.+>/,""));var C=f.next(n.pricePrefix).nextTag("td3").tagContents();c=f.next(n.checkInDateTimePrefix).nextTag("td3").innerDate();var T=f.next(n.stayLengthPrefix).nextTag("td3").tagContents().innerCapture(/(\d+)/,1);return m=f.next(n.checkOutTimePrefix).nextTag("td3").tagContents(),T.exists()&&T.getLength()>0&&(d=modifyDate(c,int(T.toString())),m&&(d=combineDateAndTime(d,m))),h=C.innerCapture(/([\d,.]+)/,1),(p=C.innerCapture(/([^\d,.]+)/,1)).exists()&&(p=p.toString().replace(/\s*\uff08.+\uff09/,"")),ASSERT(c,g)?[{"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:r,email:a},totalPrice:h,priceCurrency:p,checkinTime:c,checkoutTime:d,reservationStatus:"http://schema.org/Reservation"+u,reservationId:x,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:i,telephone:s,url:o,address:g}}]:CONTINUE}}).call();