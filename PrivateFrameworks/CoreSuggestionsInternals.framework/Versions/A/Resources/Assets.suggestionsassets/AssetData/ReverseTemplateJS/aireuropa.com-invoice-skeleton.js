(function(){return function(e,r,t){var a,i,n,p,o,m,s,u,g,d,l,h,c,v,N,b,C,S=Scanner.fromMessage(e);S.setLocale(r);var f=[],y=[];if(a=S.getSpan().innerCapture(t.name,1).trim(),l=S.getSpan().innerCapture(regExpFormatted(/\1\s+(.*)/,t.ticketNumber),1),N=S.getSpan().innerCapture(regExpFormatted(/\1\s+([A-Z\d]{5,})/,t.reservationId),1),not(a))return CONTINUE;y[a.toString()]={name:a,seats:{},seatingType:{},ticketNumber:l,totalPrice:h,priceCurrency:c},b=S.getSpan().allInnerCapture(t.flightInfo);for(var T=0;T<b.length;T++){if(C=b[T],1===b.length){var A=/(\w{3})\s(\w{3})$/.exec(e.subject);s=A[1],d=A[2]}o=S.getDetachedSpan(C.$departureDate.toString()+" "+C.$departureHour.toString()+":"+C.$departureMinute.toString()).innerDate(),u=S.getDetachedSpan(C.$arrivalDate.toString()+" "+C.$arrivalHour.toString()+":"+C.$arrivalMinute.toString()).innerDate(),p=C.$airlineCode,i=C.$flightNumber,m=C.$departureAirport,g=C.$arrivalAirport,h=(n=S.getSpan().innerCapture(regExpFormatted(/\1\s+(.*)/,t.price),1)).innerCapture(/([\d,.]+)/,1),c=n.innerCapture(/([^\d,.]+)/,1).trim(),ASSERT(p,i,m,o,g,u)&&f.push({reservationId:N,airlineCode:p,flightNumber:i,departureAirport:m,departureCode:s,arrivalCode:d,departureTime:o,arrivalAirport:g,arrivalTime:u,passengers:y})}var $=[];for(T=0;T<f.length;T++)for(var F=f[T],k=Object.keys(F.passengers),I=0;I<k.length;I++){var z=F.passengers[k[I]],D={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:F.airlineName,airlineCode:F.airlineCode,flightNumber:F.flightNumber,departureAirportFuzzy:F.departureAirport,departureAirportCode:F.departureCode,departureTime:F.departureTime,arrivalAirportFuzzy:F.arrivalAirport,arrivalAirportCode:F.arrivalCode,arrivalTime:F.arrivalTime},underName:{"@type":"http://schema.org/Person",name:z.name},checkinUrl:v,reservationId:F.reservationId,reservationStatus:"http://schema.org/ReservationConfirmed",reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:l,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:z.seats[F.flightNumber],seatingType:z.seatingType[F.flightNumber]}}};valid(z.membershipNumber,z.programName)&&(D.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:z.membershipNumber,programName:z.programName}),$.push(D)}return $.length?$:void 0}}).call();