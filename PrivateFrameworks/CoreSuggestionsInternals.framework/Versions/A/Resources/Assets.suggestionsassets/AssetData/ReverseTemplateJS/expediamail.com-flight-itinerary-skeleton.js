(function(){return function(e,t,r){if(!e||!t||!r)return CONTINUE;var a,n,i,p,m,o,s,l,g,u,d,c,h,v,x,C,T,S,N,b,y,f,$,F=Scanner.fromMessage(e);F.setLocale(t);var E=[],D={},k=(n=F.getSpan().nextRegExp(regExpFormatted(/\1/,r.travellers)).nextAnyTag("table")).getTagNumber();if(!(n=n.allInnerTags("tr"+k).map(function(e){return e.allInnerTagsFiltered("td"+k)})).length)return CONTINUE;m=(p=F.getSpan().nextText(r.priceSummary).nextText(r.totalPrice).parentAnyTag("td").tagContents()).innerCapture(regExpFormatted(/\1.*?([\d,.\s]+)/,r.totalPrice),1),o=p.innerCapture(regExpFormatted(/\1.*?([^\d,.\s]+)/,r.totalPrice),1),s=F.getSpan().innerCapture(regExpFormatted(/\1 (\d+)/,r.reservationId),1),F.getSpan().nextRegExp(regExpFormatted(/\1/,r.cancelled)).exists()?l="Cancelled":F.getSpan().next(r.pending).exists()&&(l="Pending");for(var A=0;A<n.length;A++)a=(i=n[A])[0].innerCapture(/(.*)\s/,1).trim(),x=i[1].innerCapture(regExpFormatted(/^\1/,r.noProgramName))?null:i[1].innerCapture(/($<name>.*) ($<number>\w+)/),i[2]&&(v=i[2].innerCapture(regExpFormatted(/^\1.*?(\d+)/,r.ticketNumber),1)),D[a.toString()]={name:a,totalPrice:m,priceCurrency:o,seats:{},seatingType:{},programName:x?x.$name:null,membershipNumber:x?x.$number:null,ticketNumber:v};h=F.getSpan().nextRegExp(regExpFormatted(/\1/,r.travellers));for(var I=/^($<code>[A-Z]{3})\s+($<time>\d{1,2}(?::|\sh\s|\.)\d{2}\s?(?:am|pm|uhr|uur)?)($<nextDay>\s*(?:\+[12]|\(.+\)))?/;h.nextText(r.totalTravelTime).exists();){h=h.nextText(r.totalTravelTime),d=F.getDetachedSpan(h.previousTag("td"+(k-1)).tagContents().toString().replace(",","")).innerDate(),c=(h=h.nextTag("table"+k)).allInnerTagsFiltered("td"+k);for(var P,z,R,U=0;P=c[U];U++)if(P.innerCapture(I)&&c[U+1]&&c[U+1].innerCapture(I)&&c[U+3]){b=(P=P.innerCapture(I)).$code,N=F.getDetachedSpan(d.toString()+" "+P.$time.trim().toString()).innerDate(),Date.parse(unSpanDate_(N))<Date.parse(unSpanDate_(y))&&(N=modifyDate(N,1)),f=(z=c[U+1].innerCapture(I)).$code,(R=z.$nextDay).toString().length?($=c[U+1].lastInnerDate()).toString().length<=5&&($=modifyDate(d,R.inner(/\d/))):$=d,y=F.getDetachedSpan($.toString()+" "+z.$time.trim().toString()),c[U+1].nextText(r.checkin).exists()&&U++,/\d+/.test(c[U+2].toString())||U++,T=(C=c[U+2].innerCapture(/($<name>.*)\s($<flightNumber>\d+)/))?C.$name.trim():null,S=C?C.$flightNumber:null;var O=(g=c[U+3].innerCapture(/($<type>.*?) \| ($<list>[^|]+)/))?g.$type:null;if(u=g&&g.$list.innerCapture(regExpFormatted(/^\1/,r.seat))?g.$list.innerCapture(regExpFormatted(/^\1 (.*)/,r.seat),1).split(",").map(function(e){return e.trim()}):null,valid(S)){n=Object.keys(D);for(A=0;A<n.length;A++)valid(u)&&(D[n[A]].seats[S.toString()]=u[A]),valid(O)&&(D[n[A]].seatingType[S.toString()]=O)}ASSERT(T,S,b,N,f,y)&&E.push({airlineName:T,flightNumber:S,reservationId:s,reservationStatus:l,departureCode:b,departureTime:N,arrivalCode:f,arrivalTime:y,passengers:D})}}var M,j=[];for(U=0;U<E.length;U++){M=E[U];for(var _=Object.keys(M.passengers),w=0;w<_.length;w++){var L=M.passengers[_[w]],Z={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:M.airlineName,airlineCode:M.airlineCode,flightNumber:M.flightNumber,departureAirportFuzzy:M.departureAirport,departureAirportCode:M.departureCode,departureTime:M.departureTime,arrivalAirportFuzzy:M.arrivalAirport,arrivalAirportCode:M.arrivalCode,arrivalTime:M.arrivalTime},underName:{"@type":"http://schema.org/Person",name:L.name},checkinUrl:M.checkinUrl,reservationId:M.reservationId,reservationStatus:"http://schema.org/Reservation"+(M.reservationStatus||"Confirmed"),totalPrice:L.totalPrice.trim(),priceCurrency:L.priceCurrency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:L.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:L.seats[M.flightNumber],seatingType:L.seatingType[M.flightNumber]}}};valid(L.membershipNumber,L.programName)&&(Z.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:L.membershipNumber,programName:L.programName}),j.push(Z)}}return j.length?j:void 0}}).call();