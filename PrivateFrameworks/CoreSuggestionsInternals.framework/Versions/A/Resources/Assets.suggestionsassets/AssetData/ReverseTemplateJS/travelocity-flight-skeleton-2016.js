(function(){return function(e,t,r){var a=Scanner.fromMessage(e);if(a.setLocale(t),a.getSpan().nextText(r.flightSummary).exists()){for(var n,i,o,p,g,m,s,l,d,C,u,c,h=[],T=[],v={},b=a.getSpan().next(r.names).parentAnyTag("table").allInnerTags("td6"),N=0;N<b.length;N++)(n=b[N].tagContents().innerCapture(r.name,1))&&0!==n.toString().length&&h.push(n);i=a.getSpan().nextText(r.price).nextText(r.totalPrice).parentAnyTag("td").tagContents().innerCapture(/([\d,.]+)/,1),o=a.getSpan().nextText(r.priceCurrency).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1\s(.*)$/,r.priceCurrency),1),p=a.getSpan().next(r.reservationId).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1\s*(.*)/,r.reservationId),1);var y=a.getSpan().next(r.ticketNumber).parentAnyTag("td").tagContents().toString().match(/\d+/g);for(c=0;c<h.length;c++)y&&y[c]&&(l=y[c]),v[h[c].trim()]={name:h[c].trim(),programName:r.programName,membershipNumber:d,ticketNumber:l,totalPrice:i,priceCurrency:o,seats:{},seatingType:{}};m=(s=a.getSpan().next(r.travelerInfo).parentAnyTag("table")).nextTag("td6").nextTag("td6").innerDate(),s=s.allInnerTags("td8");var A=6;for(C=0;C<s.length;C+=A)if(s[C+2]&&0!==s[C+2].tagContents().toString().length){var f,S={},x=!1;s[C+2]&&s[C+2].tagContents().toString().match(/Terminal/i)?(S.departureAirport=s[C+0].tagContents().trim()+" "+s[C+2].tagContents().trim(),S.departureTime=combineDateAndTime(m,s[C+1].tagContents().innerDate()),S.departureCode=s[C+0].tagContents().innerCapture(/([A-Z]{3})/,1),x=!1,s[C+6]&&s[C+6].tagContents().toString().match(r.dateSpecified)&&(m=s[C+6].tagContents().innerDate(),x=!0),S.arrivalAirport=s[C+3].tagContents().trim()+" "+s[C+5].tagContents().trim(),S.arrivalTime=combineDateAndTime(m,s[C+4].tagContents().innerDate()),S.arrivalCode=s[C+3].tagContents().innerCapture(/([A-Z]{3})/,1),f=s[C].previousTag("td6").tagContents().innerCapture(/($<airline>.*?)\s($<code>\d+)/),S.airlineName=f.$airline,S.airlineCode=f.$airline,S.flightNumber=f.$code,S.passengers=v,x&&C++):(A=4,S.departureAirport=s[C+0].tagContents().trim(),S.departureTime=combineDateAndTime(m,s[C+1].tagContents().innerDate()),S.departureCode=s[C+0].tagContents().innerCapture(/([A-Z]{3})/,1),x=!1,s[C+5]&&s[C+5].tagContents().toString().match(r.dateSpecified)&&(m=s[C+5].tagContents().innerDate(),x=!0),S.arrivalAirport=s[C+2].tagContents().trim(),S.arrivalTime=combineDateAndTime(m,s[C+3].tagContents().innerDate()),S.arrivalCode=s[C+2].tagContents().innerCapture(/([A-Z]{3})/,1),f=s[C].previousTag("td6").tagContents().innerCapture(/($<airline>.*?)\s($<code>\d+)/),S.airlineName=f.$airline,S.airlineCode=loadHelper("icaoCodeToIataCode.js")(f.$airline),S.flightNumber=f.$code,S.passengers=v,x&&C++),ASSERT(S.departureTime,S.arrivalTime,S.departureCode,S.arrivalCode,S.flightNumber,S.airlineName)&&T.push(S)}else C++;g=r.cancelled.test(e.plain)?"Cancelled":"Confirmed";var D,$=[];for(C=0;C<T.length;C++){var k=T[C],F=Object.keys(k.passengers);for(u=0;u<F.length;u++){var I=k.passengers[F[u]];D={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:k.airlineName,airlineCode:k.airlineCode,flightNumber:k.flightNumber,departureAirportFuzzy:k.departureAirport,departureAirportCode:k.departureCode,departureTime:k.departureTime,arrivalAirportFuzzy:k.arrivalAirport,arrivalAirportCode:k.arrivalCode,arrivalTime:k.arrivalTime},underName:{"@type":"http://schema.org/Person",name:I.name},checkinUrl:k.checkinUrl,reservationId:p,reservationStatus:"http://schema.org/Reservation"+(g||"Confirmed"),reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:I.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:I.seats[k.flightNumber],seatingType:I.seatingType[k.flightNumber]}},totalPrice:I.totalPrice,priceCurrency:I.priceCurrency},not(I.membershipNumber)||(D.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:I.membershipNumber,programName:I.programName}),$.push(D)}}if($.length)return $}}}).call();