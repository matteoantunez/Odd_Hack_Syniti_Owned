(function(){return function(e,r,t){if(!e||!r||!t)return CONTINUE;var a,n,i,p,o,m,l,s,g,u,d,c,h,v,S,x,T,C,N,b,f,y,$=Scanner.fromMessage(e);$.setLocale(r);var F=[],E={},k=(n=$.getSpan().nextRegExp(regExpFormatted(/\1/,t.travellers)).nextAnyTag("table")).getTagNumber();if(!(n=n.allInnerTags("tr"+k).map(function(e){return e.allInnerTagsFiltered("td"+k)})).length)return CONTINUE;o=(p=$.getSpan().nextText(t.priceSummary).nextText(t.totalPrice).parentAnyTag("td").tagContents()).innerCapture(regExpFormatted(/\1.*?([\d,.]+)/,t.totalPrice),1),m=p.innerCapture(regExpFormatted(/\1.*?([^\d,.\s]+)/,t.totalPrice),1),l=$.getSpan().innerCapture(regExpFormatted(/\1 (\d+)/,t.reservationId),1),s=$.getSpan().next(regExpFormatted(/[\s\S]+\1/,t.travellers)).inner(t.cancelled).isNullSpan_?"Confirmed":"Cancelled";for(var A=0;A<n.length;A++)a=(i=n[A])[0].innerCapture(/(.*)\s/,1).trim(),S=i[1].innerCapture(regExpFormatted(/^\1/,t.noProgramName))?null:i[1].innerCapture(/($<name>.*) ($<number>\w+)/),i[2]&&(v=i[2].innerCapture(regExpFormatted(/^\1.*?(\d+)/,t.ticketNumber),1)),E[a.toString()]={name:a,totalPrice:o,priceCurrency:m,seats:{},seatingType:{},programName:S?S.$name:null,membershipNumber:S?S.$number:null,ticketNumber:v};h=$.getSpan().nextRegExp(regExpFormatted(/\1/,t.travellers));for(var I=/^($<code>[A-Z]{3})\s+($<time>\d{1,2}(?::|\sh\s)\d{2}(?:am|pm)?)($<nextDay>\s+\+1)?/,D=0,P=!1,z=0,R=!1;h.nextText(t.totalTravelTime).exists();){var U,O;h=h.nextText(t.totalTravelTime),d=$.getDetachedSpan(h.previousTag("td"+(k-1)).tagContents().toString().replace(",","")).innerDate(),c=(h=h.nextTag("table"+k)).allInnerTagsFiltered("td"+k),D%8==0&&("Special Fare"===c[D].toString()?(U=c[D+1],O=c[D+2],P=!0,R=!0):(U=c[D],O=c[D+1],P=!0,R=!0)),D+=8;for(var M,j,L=0;M=c[L];L++)if(M.innerCapture(I)&&c[L+1]&&c[L+1].innerCapture(I)&&c[L+3]){M=M.innerCapture(I),(!R||c.length>8)&&(z%8==0&&(c[z]&&"Special Fare"===c[z].toString()?(U=c[z+1],O=c[z+2]):(U=c[z],O=c[z+1])),/Layover/.test(c[z+7])?z+=8:z+=7),b=M.$code,N=$.getDetachedSpan(d.toString()+" "+M.$time.toString()).innerDate(),y=(j=c[L+1].innerCapture(I)).$code,f=$.getDetachedSpan((j.$nextDay.toString().length?c[L+1].lastInnerDate().toString():d.toString())+" "+j.$time.toString()),regExpFormatted(/(?:\1\s*)+/,f.toString()).test(f.toString())&&(f=f.replace(/(\d?\d:\d{2}(am|pm))\s.*/i,"$1")),c[L+1].nextText(t.checkin).exists()&&L++,/\d+/.test(c[L+2].toString())||L++,T=(x=c[L+2].innerCapture(/($<name>.*)\s($<flightNumber>\d+)/))?x.$name.trim():null,C=x?x.$flightNumber:null;var w=(g=c[L+3].innerCapture(/($<type>.*?) \| ($<list>[^|]+)/))?g.$type:null;if(u=g&&g.$list.innerCapture(regExpFormatted(/^\1/,t.seat))?g.$list.innerCapture(regExpFormatted(/^\1 (.*)/,t.seat),1).split(",").map(function(e){return e.trim()}):null,valid(C)){n=Object.keys(E);for(A=0;A<n.length;A++)valid(u)&&(E[n[A]].seats[C.toString()]=u[A]),valid(w)&&(E[n[A]].seatingType[C.toString()]=w)}ASSERT(T,C,b,N,y,f)&&(P&&(D=0),F.push({airlineName:T,flightNumber:C,reservationId:l,reservationStatus:s,departureCode:b,arrivalAirport:O,departureAirport:U,departureTime:N,arrivalCode:y,arrivalTime:f,passengers:E}))}}var Z,_=[];for(L=0;L<F.length;L++){Z=F[L];for(var q=Object.keys(Z.passengers),B=0;B<q.length;B++){var G=Z.passengers[q[B]],H={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:Z.airlineName,airlineCode:Z.airlineCode,flightNumber:Z.flightNumber,departureAirportFuzzy:Z.departureAirport,departureAirportCode:Z.departureCode,departureTime:Z.departureTime,arrivalAirportFuzzy:Z.arrivalAirport,arrivalAirportCode:Z.arrivalCode,arrivalTime:Z.arrivalTime},underName:{"@type":"http://schema.org/Person",name:G.name},checkinUrl:Z.checkinUrl,reservationId:Z.reservationId,reservationStatus:"http://schema.org/Reservation"+(Z.reservationStatus||"Confirmed"),reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:G.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:G.seats[Z.flightNumber],seatingType:G.seatingType[Z.flightNumber]}}};valid(G.membershipNumber,G.programName)&&(H.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:G.membershipNumber,programName:G.programName}),_.push(H)}}return _.length?_:void 0}}).call();