(function(){return function(e,t,r){if(!e||!t||!r)return CONTINUE;var a,n,i,p,o,m,g,s,l,u,d,c,h,x,v,C,T,b,N,S,f,y=Scanner.fromMessage(e);y.setLocale(t);var $=[],F={},E=(n=y.getSpan().nextRegExp(regExpFormatted(/\1/,r.travellers)).nextAnyTag("table")).getTagNumber();if(!(n=n.allInnerTags("tr"+E).map(function(e){return e.allInnerTagsFiltered("td"+E)})).length)return CONTINUE;o=(p=y.getSpan().nextText(r.priceSummary).nextText(r.totalPrice).parentTag("td5").tagContents().innerCapture(regExpFormatted(/\1.*?([\d,.]+)/,r.totalPrice),1)).nextTag("td5").tagContents().innerCapture(regExpFormatted(/\b\1 ([\w ]+)\.?/,r.priceCurrency),1),(m=y.getSpan().next(r.flightResPrefix).nextTag("td6").tagContents()).exists()||(m=y.getSpan().innerCapture(regExpFormatted(/\1 (\d+)/,r.reservationId),1)),y.getSpan().nextRegExp(regExpFormatted(/\1/,r.cancelled)).exists()?g="Cancelled":y.getSpan().next(r.pending).exists()&&(g="Pending");for(var k=0;k<n.length;k++)a=(i=n[k])[0].innerCapture(/(.*)\s/,1).trim(),x=i[1].innerCapture(regExpFormatted(/^\1/,r.noProgramName))?null:i[1].innerCapture(/($<name>.*) ($<number>\w+)/),i[2]&&(h=i[2].innerCapture(regExpFormatted(/^\1 (\d+)/,r.ticketNumber),1)),F[a.toString()]={name:a,totalPrice:p,priceCurrency:o,seats:{},seatingType:{},programName:x?x.$name:null,membershipNumber:x?x.$number:null,ticketNumber:h};c=y.getSpan().nextRegExp(regExpFormatted(/\1/,r.travellers));for(var I=/^($<code>[A-Z]{3})\s+($<time>\d{1,2}:\d{2}(?:am|pm)?)($<nextDay>\s+\+1)?/;c.nextText(r.totalTravelTime).exists();){c=c.nextText(r.totalTravelTime),u=y.getDetachedSpan(c.previousTag("td"+(E-1)).tagContents().toString().replace(",","")).innerDate(),d=(c=c.nextTag("table"+E)).allInnerTagsFiltered("td"+E);for(var P,A,D=0;P=d[D];D++)if(P.innerCapture(I)&&d[D+1]&&d[D+1].innerCapture(I)&&d[D+3]){N=(P=P.innerCapture(I)).$code,b=y.getDetachedSpan(u.toString()+" "+P.$time.toString()).innerDate(),f=(A=d[D+1].innerCapture(I)).$code,S=y.getDetachedSpan((A.$nextDay.toString().length?d[D+1].lastInnerDate().toString():u.toString())+" "+A.$time.toString()),d[D+1].nextText(r.checkin).exists()&&D++,/\d+/.test(d[D+2].toString())||D++,C=(v=d[D+2].innerCapture(/($<name>.*)\s($<flightNumber>\d+)/))?v.$name.trim():null,T=v?v.$flightNumber:null;var R=(s=d[D+3].innerCapture(/($<type>.*?) \| ($<list>[^|]+)/))?s.$type:null;if(l=s&&s.$list.innerCapture(regExpFormatted(/^\1/,r.seat))?s.$list.innerCapture(regExpFormatted(/^\1 (.*)/,r.seat),1).split(",").map(function(e){return e.trim()}):null,valid(T)){n=Object.keys(F);for(k=0;k<n.length;k++)valid(l)&&(F[n[k]].seats[T.toString()]=l[k]),valid(R)&&(F[n[k]].seatingType[T.toString()]=R)}ASSERT(C,T,N,b,f,S)&&$.push({airlineName:C,flightNumber:T,reservationId:m,reservationStatus:g,departureCode:N,departureTime:b,arrivalCode:f,arrivalTime:S,passengers:F})}}var z,U=[];for(D=0;D<$.length;D++){z=$[D];for(var O=Object.keys(z.passengers),M=0;M<O.length;M++){var j=z.passengers[O[M]],w={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:z.airlineName,airlineCode:z.airlineCode,flightNumber:z.flightNumber,departureAirportFuzzy:z.departureAirport,departureAirportCode:z.departureCode,departureTime:z.departureTime,arrivalAirportFuzzy:z.arrivalAirport,arrivalAirportCode:z.arrivalCode,arrivalTime:z.arrivalTime},underName:{"@type":"http://schema.org/Person",name:j.name},checkinUrl:z.checkinUrl,reservationId:z.reservationId,reservationStatus:"http://schema.org/Reservation"+(z.reservationStatus||"Confirmed"),totalPrice:j.totalPrice,priceCurrency:j.priceCurrency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:j.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:j.seats[z.flightNumber],seatingType:j.seatingType[z.flightNumber]}}};valid(j.membershipNumber,j.programName)&&(w.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:j.membershipNumber,programName:j.programName}),U.push(w)}}return U.length?U:void 0}}).call();