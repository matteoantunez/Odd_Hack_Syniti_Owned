(function(){return function(e,t,r){if(!e||!t||!r)return CONTINUE;var a,n,i,o,p,s,d,l,g=Scanner.fromMessage(e);g.setLocale(t);var m,c,h,u,v,T,x,f,y,C,A,b,S,N,k,F,P,R,I,E,$,D,U,z,O,L=[],M=[],j={},B=[],Z=[];if(d=g.getSpan().innerCapture(regExpFormatted(/\b\1 (\d+)/,r.reservationId),1),p=(S=g.getSpan().next(r.totalPrice).nextTag("td8").tagContents()).innerCapture(/([\d,.]+)/,1),s=S.innerCapture(/([^\d,.]+)/,1),g.getSpan().nextRegExp(regExpFormatted(/\1/,r.flight.names)).exists()){for(var q=0,w=(n=(n=g.getSpan().innerCapture(regExpFormatted(/\1 (.*)\s/,r.flight.names),1)).split(", ")).length;q<w;q++)j[n[q].toString()]={name:n[q],seats:{},seatingType:{},totalPrice:p,priceCurrency:s};if(Object.keys(j).length){o=g.getSpan().nextRegExp(regExpFormatted(/\1/,r.flight.names)).previousAnyTag("table"),i=o.getTagNumber(),(o=o.nextTag("table"+i)).inner(r.taxes).exists()&&(o=o.nextTag("table"+i));for(q=0,w=(o=o.allInnerTags("tr"+i).map(function(e){return e.allInnerTagsFiltered("td"+i)}).filter(function(e){return e.length>=4})).length;q<w;q++)(h=(c=o[q])[0].innerCapture(regExpFormatted(/($<departureAirport>.*)\s+\((?:($<departureCode>[A-Z].*)\))?\s+\1\s+($<arrivalAirport>.*)\s+\((?:($<arrivalCode>.*)\))?/,r.flight.to)))&&(f=h.$departureAirport,3===h.$departureCode.toString().length&&(y=h.$departureCode),A=h.$arrivalAirport,3===h.$arrivalCode.toString().length&&(b=h.$arrivalCode)),m=c[1].innerDate(),(l=g.getDateDD(c[2].innerDate())).endIso8601&&(x=combineDateAndTime(m,l.iso8601),C=combineDateAndTime(m,l.endIso8601)),v=(u=c[3].innerCapture(/($<name>.*) ($<flightNumber>\d+)/))?u.$name:null,T=u?u.$flightNumber:null,ASSERT(v,T,x,OR(y,f),C,OR(b,A))&&M.push({airlineName:v,flightNumber:T,reservationId:d,departureAirport:f,departureCode:y,departureTime:x,arrivalAirport:A,arrivalCode:b,arrivalTime:C,passengers:j})}}if(g.getSpan().nextText(r.hotel.name).exists()){a=g.getSpan().innerCapture(regExpFormatted(/\1\s+(.*) -/,r.hotel.name),1),not(p)&&(p=g.getSpan().nextText(r.hotel.totalPrice).nextTag("td8").tagContents().innerCapture(/([\d,.]+)/,1)),o=a.nextAnyTag("table"),i=o.getTagNumber(),o.inner(r.taxes).exists()&&(o=o.nextTag("table"+i)),F=(o=o.allInnerTagsFiltered("td"+i))[0],R=p.nextTag("table7").innerAddress(),P=p.nextTag("table7").innerPhoneNumber();for(var G,H="",J=1;J<o.length;J++)if(o[J].innerCapture(regExpFormatted(/^\1/,r.hotel.telephone))){for(var K=J-1;K>0;K--)H=o[K]+"\n"+H;(not(R)||H.length>R.getLength())&&(R=H),G=o[J].innerCapture(regExpFormatted(/^\1 (.*)/,r.hotel.telephone),1),valid(G)&&(not(P)||valid(P)&&G.getLength()>P.getLength())&&(P=G)}else o[J].innerCapture(regExpFormatted(/^\1/,r.hotel.checkin))?N=o[J].innerDate():o[J].innerCapture(regExpFormatted(/^\1/,r.hotel.checkout))&&(k=o[J].innerDate());ASSERT(R,N,k)&&B.push({name:a,reservationId:d,totalPrice:p,hotelName:F,hotelAddress:R,hotelPhone:P,checkInDateTime:N,checkOutDateTime:k})}g.getSpan().nextText(r.car.name).exists()&&(a=g.getSpan().nextText(r.car.name).parentAnyTag("td").innerCapture(regExpFormatted(/\b\1 (.*)\s/,r.car.name),1),p=g.getSpan().nextText(r.car.totalPrice).nextAnyTag("td").tagContents().innerCapture(/([\d,.]+)/,1),E=g.getSpan().nextText(r.car.provider).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1 (.*?),/,r.car.provider),1),I=g.getSpan().nextText(r.car.totalPrice).nextTag("table7").allInnerTagsFiltered("td7")[0],z=getFuzzyDate(g.getSpan().next(r.car.pickup).parentAnyTag("td")),U=(U=g.getSpan().next(r.car.pickup).parentAnyTag("td")).innerAddress().exists()?U.tagContents().innerCapture(/(.*)$/,1):a.parentAnyTag("td").innerAddress().exists()?a.parentAnyTag("td").innerAddress():null,D=getFuzzyDate(g.getSpan().next(r.car.dropoff).parentAnyTag("td")),$=($=g.getSpan().next(r.car.dropoff).parentAnyTag("td")).innerAddress().exists()?$.tagContents().innerCapture(/(.*)$/,1):a.parentAnyTag("td").innerAddress().exists()?a.parentAnyTag("td").innerAddress():null,ASSERT(a,z,E)&&Z.push({name:a,reservationId:d,totalPrice:p,pickupTime:z,pickupAddress:U,dropoffTime:D,dropoffAddress:$,brand:I,provider:E}));var Q;for(q=0;q<M.length;q++){Q=M[q];for(var V=Object.keys(Q.passengers),W=0;W<V.length;W++){var X=Q.passengers[V[W]];O={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:Q.airlineName,airlineCode:Q.airlineCode,flightNumber:Q.flightNumber,departureAirportFuzzy:Q.departureAirport,departureAirportCode:Q.departureCode,departureTime:Q.departureTime,arrivalAirportFuzzy:Q.arrivalAirport,arrivalAirportCode:Q.arrivalCode,arrivalTime:Q.arrivalTime},underName:{"@type":"http://schema.org/Person",name:X.name},checkinUrl:Q.checkinUrl,reservationId:Q.reservationId,reservationStatus:"http://schema.org/Reservation"+(Q.reservationStatus||"Confirmed"),totalPrice:X.totalPrice,priceCurrency:X.priceCurrency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:X.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:X.seats[Q.flightNumber],seatingType:X.seatingType[Q.flightNumber]}}},valid(X.membershipNumber,X.programName)&&(O.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:X.membershipNumber,programName:X.programName}),L.push(O)}}var Y;for(q=0;q<Z.length;q++)O={"@context":"http://schema.org","@type":"http://schema.org/RentalCarReservation",totalPrice:(Y=Z[q]).totalPrice,priceCurrency:Y.priceCurrency,reservationId:Y.reservationId,reservationStatus:"http://schema.org/Reservation"+(Y.reservationStatus||"Confirmed"),checkinUrl:Y.checkinUrl,modifyReservationUrl:Y.modifyReservationUrl,cancelReservationUrl:Y.cancelReservationUrl,underName:{"@type":"http://schema.org/Person",name:Y.name,email:Y.email},provider:{"@type":"http://schema.org/Organization",name:Y.provider},pickupTime:Y.pickupTime,pickupLocation:{"@type":"http://schema.org/Place",name:Y.pickupName,telephone:Y.pickupTelephone,address:Y.pickupAddress},dropoffTime:Y.dropoffTime,dropoffLocation:{"@type":"http://schema.org/Place",name:Y.dropoffName,telephone:Y.dropoffTelephone,address:Y.dropoffAddress}},Y.brand&&(O.reservationFor={"@type":"http://schema.org/Car",brand:{"@type":"http://schema.org/Organization",name:Y.brand},license:Y.license,color:Y.color}),L.push(O);var _;for(q=0;q<B.length;q++)L.push(O={"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:(_=B[q]).name,email:_.email},totalPrice:_.totalPrice,priceCurrency:_.priceCurrency,checkinTime:_.checkInDateTime,checkoutTime:_.checkOutDateTime,modifyReservationUrl:_.modifyReservationUrl,cancelReservationUrl:_.cancelReservationUrl,reservationStatus:"http://schema.org/Reservation"+(_.reservationStatus||"Confirmed"),reservationId:_.reservationId,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:_.hotelName,url:_.hotelUrl,telephone:_.hotelPhone,address:_.hotelAddress}});return L.length?L:void 0}}).call();