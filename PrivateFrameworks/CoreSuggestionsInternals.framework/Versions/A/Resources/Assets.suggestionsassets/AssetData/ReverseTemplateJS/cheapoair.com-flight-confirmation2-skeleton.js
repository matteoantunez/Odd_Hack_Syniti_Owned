(function(){return function(e,t,r){function a(e){if(e.toString())for(var t=e.allInnerTags("table5"),a=(t.length+1)/4,n=0;n<a;n++){var i=t[4*n].innerCapture(regExpFormatted(/($<airlineName>[A-Za-z\s]+?)\n\1($<flightNumber>.+)/,r.flight)),o={};o.airlineName=i.$airlineName.trim(),o.flightNumber=i.$flightNumber.innerCapture(/\d+/);var s=t[1+4*n].allInnerTagsFiltered("td5"),d=s[0].innerDate();o.departureAirport=s[1];var g=s[2].innerCapture(/($<departureAirportCode>[A-Z]+?)\s-\s($<departureTime>.+)/);o.departureAirportCode=g.$departureAirportCode,o.departureTime=combineDateAndTime(d,g.$departureTime);var m=s[5].innerDate();o.arrivalAirport=s[3];var l=s[4].innerCapture(/($<arrivalAirportCode>[A-Z]+?)\s-\s($<arrivalTime>.+)/);o.arrivalAirportCode=l.$arrivalAirportCode,o.arrivalTime=combineDateAndTime(m,l.$arrivalTime),ASSERT(o.airlineName,o.flightNumber,o.departureAirport,o.departureAirportCode,o.departureTime,o.arrivalAirport,o.arrivalAirportCode,o.arrivalTime)&&p.push(o)}return p}var n,i=Scanner.fromMessage(e);i.setLocale(t);var o=[],p=[],s=[];if(i.getSpan().nextText(r.flightHeader).exists()){n=i.getSpan().nextText(r.reservationId).parentAnyTag("td").innerCapture(regExpFormatted(/\1(\d+)/,r.reservationId),1);var d=i.getSpan().nextText(r.flightHeader).nextText(r.departingFlight).parentAnyTag("table");p=a(d);var g=i.getSpan().nextText(r.flightHeader).nextText(r.returnFlight).parentAnyTag("table");p=a(g);for(var m=i.getSpan().nextText(r.travelerHeader).parentAnyTag("table").allInnerTagsFiltered("tr4"),l=(m.length-2)/2,h=0;h<l;h++){var c=m[2*h+2].allInnerTagsFiltered("td4");o.push({ticketNumber:c[0],passengerName:c[1]})}}if(i.getSpan().nextText(r.carHeader).exists()){var u,x,T,v,A,C,f,y,S,N,b=i.getSpan().nextText(r.carHeader),D=b.nextTag("table5").allInnerTagsFiltered("td5")[0].innerCapture(/(.+)\n(.+)/),F=D[1],k=D[2].innerCapture(/[\d\-\.]+/),P=b.nextText(r.carPickUp).nextDate(),$=P.nextAnyTag("td").tagContents().innerCapture(/(.+)\n?(.+)?\n?(.+)?/),I=$[1];I.toString().match(",")&&(I=I.replace(/,/," ")),$[2]&&(u=$[2]).toString().match(",")&&(u=u.replace(/,/," ")),$[3]&&(T=(x=$[3].split(","))[1].trim(),v=x[2].trim(),A=x[3].trim());var R=b.nextText(r.carDropOff).nextDate(),z=R.nextAnyTag("td").tagContents().innerCapture(/(.+)\n?(.+)?\n?(.+)?/),H=z[1];H.toString().match(",")&&(H=H.replace(/,/," ")),z[2]&&(C=z[2]).toString().match(",")&&(C=C.replace(/,/," ")),z[3]&&(y=(f=z[3].split(","))[1].trim(),S=f[2].trim(),N=f[3].trim());var L=b.nextText(r.carConfirmation).parentAnyTag("td").innerCapture(regExpFormatted(/\1\s?\n?(\w+)/,"Car Confirmation:"),1),E=L.nextText(r.mileage).nextAnyTag("td").tagContents().innerCapture(/.+\s?\n?(.+)/,1).nextAnyTag("td").tagContents();P=unSpanDate_(P),R=unSpanDate_(R);var M={"@context":"http://schema.org","@type":"http://schema.org/RentalCarReservation",reservationId:L,reservationStatus:"http://schema.org/ReservationConfirmed",underName:{"@type":"http://schema.org/Person",name:E},provider:{"@type":"http://schema.org/Organization",name:F},pickupTime:P,pickupLocation:{"@type":"http://schema.org/Place",name:I.trim(),telephone:k.toString(),address:{"@type":"http://schema.org/PostalAddress",addressLocality:T,addressRegion:v,addressCountry:A,streetAddress:u.trim()}},dropoffTime:R,dropoffLocation:{"@type":"http://schema.org/Place",telephone:k.toString(),address:{"@type":"http://schema.org/PostalAddress",addressLocality:y,addressRegion:S,addressCountry:N,streetAddress:C.trim()}}};s.push(M)}if(i.getSpan().nextText(r.hotelHeader).exists()){var O=i.getSpan().nextText(r.hotelHeader),Z=O.nextTag("td4").tagContents(),w=Z.nextPhoneNumber();if(!(_=Z.nextAnyTag("td").nextAnyTag("td").innerAddress()).toString())var _=Z.nextPhoneNumber().parentAnyTag("td").tagContents().innerCapture(/([\.\s\,\w]+?)Phone:/,1).trim();var B=w.nextText(r.checkIn).nextDate(),U=w.nextText(r.checkOut).nextDate(),j=U.nextText(r.checkinTime).nextDate(),q=U.nextText(r.checkoutTime).nextDate();q.exists()||(q=i.getDetachedSpan("12:00 PM")),j.exists()||(j=i.getDetachedSpan("12:00 PM"));var G=combineDateAndTime(B,j),J=combineDateAndTime(U,q),K=O.nextText(r.guestName).nextTag("td4").nextTag("td4").nextAnyTag("td").tagContents();s.push(M={"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:K},checkinTime:G,checkoutTime:J,reservationStatus:"http://schema.org/ReservationConfirmed",reservationId:n,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:Z,telephone:w,address:_}})}for(h=0;h<p.length;h++)for(var Q=p[h],V=0;V<o.length;V++){var W=o[V];M={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:Q.airlineName,flightNumber:Q.flightNumber.toString(),departureAirportFuzzy:Q.departureAirport,departureAirportCode:Q.departureAirportCode,departureTime:Q.departureTime,arrivalAirportFuzzy:Q.arrivalAirport,arrivalAirportCode:Q.arrivalAirportCode,arrivalTime:Q.arrivalTime},underName:{"@type":"http://schema.org/Person",name:W.passengerName},reservationId:n,reservationStatus:"http://schema.org/ReservationConfirmed",reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:W.ticketNumber}};s.push(M)}if(s.length)return s}}).call();