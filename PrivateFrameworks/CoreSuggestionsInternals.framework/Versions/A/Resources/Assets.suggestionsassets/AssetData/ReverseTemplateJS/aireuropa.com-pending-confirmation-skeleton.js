(function(){return function(e,r,t){var a,n,i,o,p,m,l,u=Scanner.fromMessage(e);u.setLocale(r);var s=[],d={};for(a=u.getSpan().next(t.reservationId).parentAnyTag("td").tagContents().innerCapture(/(\w+)/,1),n=u.getSpan().allInnerCapture(t.passportNumber,1),m=0;m<n.length;m++)(p={}).name=n[m].parentAnyTag("table").nextAnyTag("td").tagContents(),p.seatingType=n[m].next(t.seatingType).nextAnyTag("td").tagContents(),ASSERT(p.name)&&(d[p.name]=p);var g=u.getSpan().allInnerCapture(t.departure,1);for(m=0;m<g.length;m++){var h={},c=g[m].parentAnyTag("table").allInnerTags("td3"),v=g[m].previousDate();if(i=c[1].tagContents().innerCapture(/($<name>\w+)\s+\(($<code>[A-Z]+)\)/),h.departureAirport=i.$name,h.departureCode=i.$code,h.departureTime=combineDateAndTime(v,c[2].innerDate()),i=c[4].tagContents().innerCapture(/($<name>\w+)\s+(\(.+\s)?\(($<code>[A-Z]+)\)/),h.arrivalAirport=i.$name,h.arrivalCode=i.$code,h.arrivalTime=combineDateAndTime(v,c[5].innerDate()),!(o=c[7].innerCapture(/($<code>\w{2})\s($<number>\d+)\s/)))return CONTINUE;h.airlineCode=o.$code,h.flightNumber=o.$number,ASSERT(h.departureCode,h.arrivalCode,h.departureTime,h.arrivalTime,h.flightNumber,h.airlineCode)&&s.push(h)}var C=[];for(m=0;m<s.length;m++){var T=s[m],b=Object.keys(d);for(l=0;l<b.length;l++){var y={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:T.airlineName,airlineCode:T.airlineCode,flightNumber:T.flightNumber,departureAirportFuzzy:T.departureAirport,departureAirportCode:T.departureCode,departureTime:T.departureTime,arrivalAirportFuzzy:T.arrivalAirport,arrivalAirportCode:T.arrivalCode,arrivalTime:T.arrivalTime},underName:{"@type":"http://schema.org/Person",name:(p=d[b[l]]).name},checkinUrl:null,reservationId:a,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:null,priceCurrency:null,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:p.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:null,seatingType:p.seatingType}}};valid(n.membershipNumber,n.programName)&&(y.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:n.membershipNumber,programName:n.programName}),C.push(y)}}if(C.length)return C}}).call();