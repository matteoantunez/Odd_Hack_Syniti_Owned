(function(){function t(t,e){var r=e.kFlight,a=e.kFrom,n=e.kTo,i=e.kStops,s=e.kDuration,o=e.passengerInformation,g=t.getSpan().nextText(r).nextText(a).nextText(n).nextText(i).nextText(s);if(!g.exists())return CONTINUE;for(var p=[],l=g.parentTag("table3").tagContents().nextTag("tr3").firstTag("tr3");l.exists()&&l.nextText(o).exists();){var u=l.nextTag("td3").tagContents(),c=u.innerCapture(/([\d]+)/,1),x=u.innerCapture(/^([A-Z]+)/,1);c=c.toString().substring(0,4);var h=l.firstTag("tr3").tagContents().firstTag("td3").tagContents(),T=h.nextTag("td3").tagContents(),f=h.innerCapture(/^(.+) (.+)\n/,1),m=T.innerCapture(/^(.+) (.+)\n/,1),d=h.innerCapture(/^(.+) (.+)\n/,2),v=T.innerCapture(/^(.+) (.+)\n/,2);if(d.exists()&&6==d.toString().length){if(d=d.toString().substring(1,4),!v.exists()||6!=v.toString().length)break;v=v.toString().substring(1,4);var C=h.toString().split("\n")[1],S=C.split("-");C=S[0].split(" ")[1]+" "+S[1].split(" ")[0]+" "+S[1].split(" ")[1];var b=h.toString().split("\n")[2],N=t.getDetachedSpan(C+" "+b).innerDate(),A=T.toString().split("\n")[1],k=A.split("-");A=k[0].split(" ")[1]+" "+k[1].split(" ")[0]+" "+k[1].split(" ")[1];var D=T.toString().split("\n")[2],y=t.getDetachedSpan(A.toString()+" "+D.toString()).innerDate();ASSERT(c,x,N,d,A,v)&&p.push({airlineName:"Air Canada",flightNumber:c,airlineCode:x,departureDate:N,departureAirport:f,departureAirportCode:d,arrivalDate:y,arrivalAirport:m,arrivalAirportCode:v}),l=l.nextTag("tr3").firstTag("tr3")}else l=l.nextTag("tr3").firstTag("tr3")}return l=null,p}function e(t,e){var r=e.bookingReference,a={};return a.reference=t.getSpan().nextText(r).nextTag("td5").tagContents(),a}function r(t,e){var r=e.passengerInformation,a=e.seatSelection,n=e.priceTotal,i=t.getSpan().nextText(n).nextTag("th3").tagContents(),s=t.getSpan().nextText(n).parentTag("th3").tagContents();if(s.exists()){var o=s.toString().split("-");2==o.length&&(s=o[1].trim())}passengers=[];for(var g,p=t.getSpan().nextText(r).nextTag("table2").firstTag("th2");p.exists();){var l=p.tagContents().toString().split(":");if(4!=l.length)break;passengerName=l[1].trim(),g=l[3].trim();var u={};p.nextText(a).firstTag("td2").tagContents().toString().split(",").forEach(function(t){seatDetail=t.trim().split(" "),seatDetail.length>1&&(u[seatDetail[0]]=seatDetail[1])}),passengers.push({name:passengerName,price:i,currency:s,ticketNumber:g,seats:u}),p=p.nextTag("th2")}return p=null,passengers}function a(t,e,r){for(var a=[],n=0;n<t.length;n++)for(var i=t[n],s=0;s<e.length;s++){var o=e[s];a.push({"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:i.airlineName,airlineCode:i.airlineCode,flightNumber:i.flightNumber,departureAirportFuzzy:i.departureAirport,departureAirportCode:i.departureAirportCode,departureTime:i.departureDate,arrivalAirportFuzzy:i.arrivalAirport,arrivalAirportCode:i.arrivalAirportCode,arrivalTime:i.arrivalDate},underName:{"@type":"http://schema.org/Person",name:o.name},reservationId:r.reference,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:o.price,priceCurrency:o.currency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:o.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:o.seats[i.airlineCode+i.flightNumber]}}})}return a}return function(n,i,s){var o=Scanner.fromMessage(n);return o.setLocale(i),a(t(o,s),r(o,s),e(o,s))}}).call();