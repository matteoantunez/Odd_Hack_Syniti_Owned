(function(){return function(e,t,r){var a,n,i,o,g,p,m,l,d,s,u,h,c,T,C,x,v=Scanner.fromMessage(e);v.setLocale(t);var N=[],f=[],b=[];a=v.getSpan().next(r.reservationId).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1\s*(.*)/i,r.reservationId),1),l=(m=v.getSpan().next(r.pricePrefix).nextAnyTag("td").tagContents()).innerCapture(/([\d,.]+)/,1),d=m.innerCapture(/([^\d,.]+)/,1).trim();var S=v.getSpan().next(r.manageBooking).next(r.itinerary);for(s=S.withEnd(S.next(r.itineraryEnd).getStart()).allInnerTagsFiltered("td5"),u=0;u<s.length;u++)h={},n=(c=s[u]).innerCapture(/^($<airlineCode>\D+)($<flightNumber>\d+)/),h.airlineCode=n.$airlineCode,h.flightNumber=n.$flightNumber,T=c.innerCapture(/^.*\n($<airlineName>.*)\|\s+($<status>.*)/),h.airlineName=T.$airlineName.trim(),h.airlineStatus=T.$status,g=(i=h.airlineName.nextTag("td8").tagContents()).nextTag("td8").tagContents(),h.departureTime=combineDateAndTime(i,g),h.departureAirport=g.nextTag("td8").nextTag("td8").tagContents(),p=(o=h.departureAirport.nextTag("table8").nextTag("td8").tagContents()).nextTag("td8").tagContents(),h.arrivalTime=combineDateAndTime(o,p),h.arrivalAirport=p.nextTag("td8").nextTag("td8").tagContents(),ASSERT(h.airlineName,h.airlineCode,h.flightNumber,h.departureTime,h.departureAirport,h.arrivalTime,h.arrivalAirport)&&N.push(h);for(C=v.getSpan().next(r.ticketNumberPrefix).collapseToEnd().withEnd(v.getSpan().next(r.passengerPostFix).getStart()).allInnerTagsFiltered("td5"),u=0;u<C.length;u++)x=C[u].tagContents().innerCapture(/($<ticketNumber>.*)\s+\(($<name>.*)\)/),b.push({name:x.$name,ticketNumber:x.$ticketNumber});for(0===b.length&&b.push({name:v.getSpan().innerCapture(r.nameCapture,1)}),u=0;u<N.length;u++){h=N[u];for(var A=0;A<b.length;A++){f.push({"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:h.airlineName,airlineCode:h.airlineCode,flightNumber:h.flightNumber,departureAirportFuzzy:h.departureAirport,departureTime:h.departureTime,arrivalAirportFuzzy:h.arrivalAirport,arrivalTime:h.arrivalTime},underName:{"@type":"http://schema.org/Person",name:(x=b[A]).name},reservationId:a,reservationStatus:"http://schema.org/ReservationPending",totalPrice:l,priceCurrency:d,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:x.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat"}}})}}if(f.length)return f}}).call();