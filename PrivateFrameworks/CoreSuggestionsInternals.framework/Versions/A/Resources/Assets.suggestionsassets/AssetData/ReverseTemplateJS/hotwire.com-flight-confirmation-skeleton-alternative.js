(function(){return function(e,r,t){if(!e||!r||!t)return CONTINUE;var a,n,i,p,m,o,g,l,s,u,d,c,h,v,x,C,T,b,N,S,y,f=Scanner.fromMessage(e);f.setLocale(r);var $=[],F={},E=(n=f.getSpan().nextRegExp(regExpFormatted(/\1/,t.travellers)).nextAnyTag("table")).getTagNumber();if(!(n=n.allInnerTags("tr"+E).map(function(e){return e.allInnerTagsFiltered("td"+E)})).length)return CONTINUE;m=(p=f.getSpan().nextText(t.priceSummary).nextText(t.totalPrice).parentTag("td5").tagContents().innerCapture(regExpFormatted(/\1.*?([\d,.]+)/,t.totalPrice),1)).nextTag("td5").tagContents().innerCapture(regExpFormatted(/\b\1 ([\w ]+)\.?/,t.priceCurrency),1),o=f.getSpan().innerCapture(regExpFormatted(/\1 (\d+)/,t.reservationId),1),f.getSpan().nextRegExp(regExpFormatted(/\1/,t.cancelled)).exists()?g="Cancelled":f.getSpan().next(t.pending).exists()&&(g="Pending");for(var k=0;k<n.length;k++)a=(i=n[k])[0].innerCapture(/(.*)\s/,1).trim(),v=i[1].innerCapture(regExpFormatted(/^\1/,t.noProgramName))?null:i[1].innerCapture(/($<name>.*) ($<number>\w+)/),i[2]&&(h=i[2].innerCapture(regExpFormatted(/^\1 (\d+)/,t.ticketNumber),1)),F[a.toString()]={name:a,totalPrice:p,priceCurrency:m,seats:{},seatingType:{},programName:v?v.$name:null,membershipNumber:v?v.$number:null,ticketNumber:h};c=f.getSpan().nextRegExp(regExpFormatted(/\1/,t.travellers));for(var I=/^($<code>[A-Z]{3})\s+($<time>\d{1,2}:\d{2}(?:am|pm)?)($<nextDay>\s+\+1)?/;c.nextText(t.totalTravelTime).exists();){c=c.nextText(t.totalTravelTime),u=f.getDetachedSpan(c.previousTag("td"+(E-1)).tagContents().toString().replace(",","")).innerDate(),d=(c=c.nextTag("table"+E)).allInnerTagsFiltered("td"+E);for(var A,P,D=0;A=d[D];D++)if(A.innerCapture(I)&&d[D+1]&&d[D+1].innerCapture(I)&&d[D+3]){N=(A=A.innerCapture(I)).$code,b=f.getDetachedSpan(u.toString()+" "+A.$time.toString()).innerDate(),y=(P=d[D+1].innerCapture(I)).$code,S=f.getDetachedSpan((P.$nextDay.toString().length?d[D+1].lastInnerDate().toString():u.toString())+" "+P.$time.toString()),d[D+1].nextText(t.checkin).exists()&&D++,/\d+/.test(d[D+2].toString())||D++,C=(x=d[D+2].innerCapture(/($<name>.*)\s($<flightNumber>\d+)/))?x.$name.trim():null,T=x?x.$flightNumber:null;var z=(l=d[D+3].innerCapture(/($<type>.*?) \| ($<list>[^|]+)/))?l.$type:null;if(s=l&&l.$list.innerCapture(regExpFormatted(/^\1/,t.seat))?l.$list.innerCapture(regExpFormatted(/^\1 (.*)/,t.seat),1).split(",").map(function(e){return e.trim()}):null,valid(T)){n=Object.keys(F);for(k=0;k<n.length;k++)valid(s)&&(F[n[k]].seats[T.toString()]=s[k]),valid(z)&&(F[n[k]].seatingType[T.toString()]=z)}ASSERT(C,T,N,b,y,S)&&$.push({airlineName:C,flightNumber:T,reservationId:o,reservationStatus:g,departureCode:N,departureTime:b,arrivalCode:y,arrivalTime:S,passengers:F})}}var R,U=[];for(D=0;D<$.length;D++){R=$[D];for(var O=Object.keys(R.passengers),M=0;M<O.length;M++){var j=R.passengers[O[M]],w={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:R.airlineName,airlineCode:R.airlineCode,flightNumber:R.flightNumber,departureAirportFuzzy:R.departureAirport,departureAirportCode:R.departureCode,departureTime:R.departureTime,arrivalAirportFuzzy:R.arrivalAirport,arrivalAirportCode:R.arrivalCode,arrivalTime:R.arrivalTime},underName:{"@type":"http://schema.org/Person",name:j.name},checkinUrl:R.checkinUrl,reservationId:R.reservationId,reservationStatus:"http://schema.org/Reservation"+(R.reservationStatus||"Confirmed"),totalPrice:j.totalPrice,priceCurrency:j.priceCurrency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:j.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:j.seats[R.flightNumber],seatingType:j.seatingType[R.flightNumber]}}};valid(j.membershipNumber,j.programName)&&(w.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:j.membershipNumber,programName:j.programName}),U.push(w)}}return U.length?U:void 0}}).call();