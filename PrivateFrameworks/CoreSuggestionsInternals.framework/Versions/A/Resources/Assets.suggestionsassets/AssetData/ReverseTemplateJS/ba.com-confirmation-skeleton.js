(function(){return function(e,t,r){var a,n=Scanner.fromMessage(e);if(n.setLocale(t),!n.getSpan().nextText(r.yourItinerary))return CONTINUE;a=n.getSpan().nextText(r.bookingReferencePrefix).parentTag("td3").innerCapture(regExpFormatted(/\1 ($<bookingReference>\w{6})/,r.bookingReferencePrefix),1);var i,g,o=n.getSpan().next(r.pricePrefix).nextTag("td4").innerCapture(/($<currency>\w+) ($<price>[\d.,]+)/);o&&(i=o.$price,g=o.$currency);var p=[],l=a.nextText(r.passengersPrefix).parentTag("table4").allInnerTags("td4").filter(function(e){return e&&e.tagContents().trim().toString().length>0});l=l.slice(1);for(var x=0;x<l.length;x++)p.push({name:l[x].tagContents().trim(),price:i,currency:g});for(var u=[],c=n.getSpan().nextText(r.flightNumberPrefix).parentTag("table5");c.exists()&&c.nextText(r.flightNumberPrefix).exists();){var d=c.nextText(r.flightNumberPrefix).nextTag("td5").tagContents().innerCapture(/($<airlineCode>\w{2})($<flightNumber>\d{1,4})/),m=d.$airlineCode,s=d.$flightNumber,f=s.nextTag("td5").nextText(r.departureAirportPrefix).nextTag("td5").tagContents();r.terminal&&f&&f.toString().indexOf(r.terminal)>0&&(f=f.innerCapture(regExpFormatted(/(.*) \1/,r.terminal),1));var h=f.nextTag("td5").nextText(r.arrivalAirportPrefix).nextTag("td5").tagContents();r.terminal&&h&&h.toString().indexOf(r.terminal)>0&&(h=h.innerCapture(regExpFormatted(/(.*) \1/,r.terminal),1));var T,v=n.getDetachedSpan(c.nextText(r.departureDatePrefix).nextTag("td5").tagContents().toString().replace(/abr/i,"apr")).allDates();T=1===v.length?v[0]:n.getDetachedSpan(v.map(function(e){return e.trim()}).join("")).firstDate();var C,S=n.getDetachedSpan(c.nextText(r.arrivalDatePrefix).nextTag("td5").tagContents().toString().replace(/abr/i,"apr")).allDates();C=1===S.length?S[0]:n.getDetachedSpan(S.map(function(e){return e.trim()}).join("")).firstDate();c.nextText(r.cabinPrefix).nextTag("td5").tagContents();var b=c.nextText(r.airlineNamePrefix).nextTag("td5").tagContents();ASSERT(b||m,s,T,f)&&(u.push({airlineName:b,airlineCode:m,flightNumber:s,departureDate:T,departureAirport:f,arrivalDate:C,arrivalAirport:h,passengers:p}),b=m=s=T=f=C=h=null),c=c.nextTag("table5")}c=null;var N=n.getSpan().nextText(r.ticketNumberPrefix).nextTag("td4").tagContents().innerCapture(/([\d-]+)/,1),P=[];for(x=0;x<u.length;x++){c=u[x];for(var y=0;y<p.length;y++){ASSERT(c.airlineName||c.airlineCode,c.flightNumber,c.departureAirport,c.departureDate);var D=p[y];P.push({"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:c.airlineName,airlineCode:c.airlineCode,flightNumber:c.flightNumber,departureAirportFuzzy:c.departureAirport,departureTime:c.departureDate,arrivalAirportFuzzy:c.arrivalAirport,arrivalTime:c.arrivalDate},underName:{"@type":"http://schema.org/Person",name:D.name},reservationId:a,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:D.price,priceCurrency:D.currency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:N,ticketedSeat:{"@type":"http://schema.org/Seat"}}})}}return P.length?P:void 0}}).call();