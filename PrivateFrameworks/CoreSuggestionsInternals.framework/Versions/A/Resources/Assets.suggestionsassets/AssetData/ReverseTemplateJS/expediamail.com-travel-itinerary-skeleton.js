(function(){return function(e,t,r){if(!e||!t||!r)return CONTINUE;r.templateHeader=r.templateHeader||[];var a,n,i,o,s,p=Scanner.fromMessage(e);p.setLocale(t);for(var l,d,m,g,h,c,u,T,f,v,x,y,C,b,N,S,A,k,F,R,I,E,P,U,z,D,$,L=[],O=[],H={},M=[],Z=[],j=p.getSpan(),w=0,B=r.emailHeader.length;w<B;w++)j=j.nextText(r.emailHeader[w]);if(j.parentAnyTag("table").exists()){if(i=(a=p.getSpan().nextText(r.mainContact).parentTag("td11").tagContents().innerCapture(regExpFormatted(/\b\1 (.*)/,r.mainContact),1)).nextText(r.emailAddress).nextTag("td13").tagContents(),p.getSpan().nextText(r.flight.verify).exists()){if(!(n=p.getSpan().nextRegExp(r.flight.travelers).nextTag("table13").allInnerTags("tr13").map(function(e){return e.allInnerTagsFiltered("td13")})).length&&a&&n.push([p.getNullSpan(),a]),n.length)for(var q=0;q<n.length;q++)H[n[q][1].toString()]={name:n[q][1],seats:{},seatingType:{}};for(m=p.getSpan().nextText(r.flight.details);m.nextTag("table12").exists();)if(!((o=(m=m.nextTag("table12")).allInnerTagsFiltered("td12")).length<=2)){g=o[0];for(w=1;w<o.length&&(s=o[w].innerCapture(regExpFormatted(/\b\1 (\w+)/,r.confirmationCode),1),!valid(s));w++);if(!((o=(m=m.nextTag("table11")).allInnerTagsFiltered("td11")).length<=7)){if(u=o[0].innerCapture(regExpFormatted(/^\1 .* \(([A-Z]{3})\)/,r.flight.depart),1),f=o[1].innerCapture(regExpFormatted(/^\1 .* \(([A-Z]{3})\)/,r.flight.arrive),1),c=combineDateAndTime(o[4],o[2]),T=combineDateAndTime(o[5],o[3]),h=o[6].innerCapture(regExpFormatted(/\b\1 (\d+)/,r.flight.flightNumber),1),(o=(m=m.nextTag("table11").nextTag("table11")).allInnerTagsFiltered("td11")).length){if(l=o[0].innerCapture(/^($<list>.*), ($<type>.*?), .*$/),valid(h,l)){d=l.$list,d=not(d)||d.innerCapture(regExpFormatted(/^\1/,r.flight.seatUnassigned))?[]:d.split(",").map(function(e){return e.trim()});var G=l.$type;n=Object.keys(H);for(q=0;q<n.length;q++)valid(d[q])&&(H[n[q].toString()].seats[h.toString()]=d[q]),valid(G)&&(H[n[q].toString()].seatingType[h.toString()]=G)}d=l?l.$list.innerCapture(/(\d+[A-Z])/,1):null}ASSERT(g,h,u,c,T,f)&&O.push({airlineName:g,flightNumber:h,departureCode:u,departureTime:c,arrivalCode:f,arrivalTime:T,reservationId:s,passengers:H})}}}p.getSpan().nextText(r.hotel.verify).exists()&&(s=(x=(v=p.getSpan().nextText(r.hotel.verify).previousText(r.hotel.checkin).nextDate()).nextText(r.hotel.checkout).nextDate()).nextText(r.confirmationCode).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\b\1\s+(\w+)$/,r.confirmationCode),1),y=(o=(o=v.previousTag("table10")).innerTag("td10").tagContents().innerCapture(/\b($<name>.*?) <($<url>.*)>/))?o.$name:null,b=(o=x.nextText(r.hotel.address).parentAnyTag("td").tagContents()).innerCapture(regExpFormatted(/\b\1\s+(.*)/,r.hotel.address),1),o.innerAddress().getLength()>b.getLength()&&(b=o.innerAddress()),C=(o=o.nextText(r.hotel.telephone).parentAnyTag("td").tagContents()).innerCapture(regExpFormatted(/\b\1\s+([-\d)( ]+)/,r.hotel.telephone),1),o.innerPhoneNumber().getLength()>C.getLength()&&(C=o.innerPhoneNumber()),ASSERT(y,b,v,x)&&M.push({name:a,email:i,hotelName:y,hotelAddress:b,hotelPhone:C,checkInDateTime:v,checkOutDateTime:x,reservationId:s})),p.getSpan().nextText(r.car.verify).exists()&&(P=p.getSpan().nextText(r.car.verify).previousText(r.car.pickup).parentAnyTag("td").tagContents(),D=getFuzzyDate(P),U=P.innerCapture(regExpFormatted(/\s\1 (.*)\s/,r.car.address),1),z=P.innerPhoneNumber(),F=P.nextText(r.car.dropoff).parentAnyTag("td").tagContents(),E=getFuzzyDate(F),R=F.innerCapture(regExpFormatted(/\s\1 (.*)\s/,r.car.address),1)||U,I=F.innerPhoneNumber().result()||z,(o=P.previousText(r.confirmationCode).parentTag("table10").allInnerTagsFiltered("td10")).length&&(k=o[0],s=o[1].innerCapture(regExpFormatted(/\b\1 (.*)/,r.confirmationCode),1),A=(o=P.previousText(r.confirmationCode).previousTag("table8")).nextTag("td8").tagContents()),ASSERT(D,U,k,s)&&Z.push({name:a,email:i,brand:A,pickupTime:D,pickupAddress:U,pickupTelephone:z,dropoffTime:E,dropoffAddress:R,dropoffTelephone:I,provider:k,reservationId:s,modifyReservationUrl:N,cancelReservationUrl:S}))}var J;for(w=0;w<O.length;w++){J=O[w];for(var K=Object.keys(J.passengers),Q=0;Q<K.length;Q++){var V=J.passengers[K[Q]];$={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:J.airlineName,airlineCode:J.airlineCode,flightNumber:J.flightNumber,departureAirportFuzzy:J.departureAirport,departureAirportCode:J.departureCode,departureTime:J.departureTime,arrivalAirportFuzzy:J.arrivalAirport,arrivalAirportCode:J.arrivalCode,arrivalTime:J.arrivalTime},underName:{"@type":"http://schema.org/Person",name:V.name},reservationId:J.reservationId,reservationStatus:"http://schema.org/Reservation"+(J.reservationStatus||"Confirmed"),totalPrice:V.price,priceCurrency:V.currency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:V.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:V.seats[J.flightNumber],seatingType:V.seatingType[J.flightNumber]}}},valid(V.membershipNumber,V.programName)&&($.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:V.membershipNumber,programName:V.programName}),L.push($)}}var W;for(w=0;w<Z.length;w++)$={"@context":"http://schema.org","@type":"http://schema.org/RentalCarReservation",totalPrice:(W=Z[w]).totalPrice,priceCurrency:W.priceCurrency,reservationId:W.reservationId,reservationStatus:"http://schema.org/Reservation"+(W.reservationStatus||"Confirmed"),checkinUrl:W.checkinUrl,modifyReservationUrl:W.modifyReservationUrl,cancelReservationUrl:W.cancelReservationUrl,underName:{"@type":"http://schema.org/Person",name:W.name,email:W.email},provider:{"@type":"http://schema.org/Organization",name:W.provider},pickupTime:W.pickupTime,pickupLocation:{"@type":"http://schema.org/Place",name:W.pickupName,telephone:W.pickupTelephone,address:W.pickupAddress},dropoffTime:W.dropoffTime,dropoffLocation:{"@type":"http://schema.org/Place",name:W.dropoffName,telephone:W.dropoffTelephone,address:W.dropoffAddress}},W.brand&&($.reservationFor={"@type":"http://schema.org/Car",brand:{"@type":"http://schema.org/Organization",name:W.brand},license:W.license,color:W.color}),L.push($);var X;for(w=0;w<M.length;w++)L.push($={"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:(X=M[w]).name,email:X.email},totalPrice:X.totalPrice,priceCurrency:X.priceCurrency,checkinTime:X.checkInDateTime,checkoutTime:X.checkOutDateTime,modifyReservationUrl:X.modifyReservationUrl,cancelReservationUrl:X.cancelReservationUrl,reservationStatus:"http://schema.org/Reservation"+(X.reservationStatus||"Confirmed"),reservationId:X.reservationId,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:X.hotelName,url:X.hotelUrl,telephone:X.hotelPhone,address:X.hotelAddress}});return L.length?L:void 0}}).call();