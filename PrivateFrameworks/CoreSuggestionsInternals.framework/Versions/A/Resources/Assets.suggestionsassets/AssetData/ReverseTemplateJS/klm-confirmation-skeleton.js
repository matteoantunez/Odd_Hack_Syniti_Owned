(function(){return function(e,t,r){function a(e){var r;if("ja_JP"===t){if(r=e.tagContents().innerCapture(/($<day>\d{1,2}) ($<month>\d{1,2}) ($<year>\d{2})/),valid(r))return g.getDetachedSpan(r.$month.toString()+"/"+r.$day.toString()+"/20"+r.$year.toString()).innerDate()}else{if("zh_Hans_CN"!==t){if("es_ES"===t){if(r=e.tagContents().innerCapture(/.*?\s($<day>.+?)\s($<month>.+?)\s($<year>.*?)/)){var a=J[r.$month.toString()];return g.getDetachedSpan(r.$day.toString()+"/"+a+"/"+r.$year.toString()).innerDate()}return e.tagContents().innerDate()}return e.tagContents().innerDate()}if(r=e.tagContents().innerCapture(/($<day>\d{1,2}) ($<month>.{2,3}) ($<year>\d{2})/),valid(r))return g.getDetachedSpan(r.$year+"\u5e74"+r.$month.toString()+r.$day.toString()+"\u65e5").innerDate()}}var n,i,g=Scanner.fromMessage(e);g.setLocale(t);var o,p,l,m,s,d,u,h,T,c,x,v,S,C,b,f,y,N,D,$,A,P,k,z,F,I,_,j,R,U,E,L=[],M=[],O={};n=g.getSpan().next(r.confirmationCode).parentTag("table4").nextTag("table5").tagContents(),p=g.getSpan().nextText(r.passenger).parentTag("table4").nextTag("table5").nextTag("table5").allInnerTags("td5"),s=(u=g.getSpan().nextText(r.totalPrice).nextTag("td5").nextTag("td5").tagContents().innerCapture(/($<currency>\w+)\s($<totalPrice>.+)/))?u.$totalPrice:null,d=u?u.$currency:null;for(var K=0;K<p.length;K+=3)o=p[K+1].tagContents().innerCapture(/(.+)\(/,1).trim(),f=p[K+2].nextText(r.ticketNumber).nextTag("td7").tagContents().toString(),O[o]={name:o,programName:N,membershipNumber:y,ticketNumber:f,seats:{},seatingType:{},totalPrice:s,priceCurrency:d};l=n.nextRegExp(r.flightSummary).nextTag("table4").allInnerTags("table6").filter(function(e){return!r.totalTravelTime.test(e)});for(var w=g.getSpan().nextRegExp(r.flightSummary).nextTag("table4").allInnerTags("td5").map(function(e){return e.allInnerTagsFiltered("td5")}).filter(function(e){return r.flightNumber.test(e)||r.train.test(e)}),B=[],H=0;H<l.length;H++)B.push([l[H],w[H]]);var J={ene:"01",feb:"02",mar:"03",abr:"04",may:"05",jun:"06",jul:"07",ago:"08",sep:"09",oct:"10",nov:"11",dic:"12"};for(H=0;H<B.length;H++)c=B[H][0].nextTag("td6").tagContents().innerDate(),(c=a(B[H][0].nextTag("td6"))).length||"nl_NL"!==t||(c=B[H][0].nextTag("td6").tagContents().replace(/mrt/,"mar").innerDate()),"it_IT"===t&&c.toString().match("gen")&&(c=g.getDetachedSpan(B[H][0].nextTag("td6").tagContents().toString().replace("gen","jan")).innerDate()),x=B[H][0].nextTag("td6").nextTag("td6").tagContents().innerDate(),x=combineDateAndTime(c,x),v=B[H][0].nextTag("td6").nextTag("td6").tagContents().innerCapture(/\d\d:\d\d\s(.+)/,1),(S=a(B[H][0].nextTag("tr6").nextTag("tr6").nextTag("td6"))).length||"nl_NL"!==t||(S=B[H][0].nextTag("tr6").nextTag("tr6").nextTag("td6").tagContents().replace(/mrt/,"mar").innerDate()),"it_IT"===t&&S.toString().match("gen")&&(S=g.getDetachedSpan(B[H][0].nextTag("tr6").nextTag("tr6").nextTag("td6").tagContents().toString().replace("gen","jan")).innerDate()),C=B[H][0].nextTag("tr6").nextTag("tr6").nextTag("td6").nextTag("td6").tagContents().innerDate(),C=combineDateAndTime(S,C),b=B[H][0].nextTag("tr6").nextTag("tr6").nextTag("td6").nextTag("td6").tagContents().innerCapture(/\d\d:\d\d\s(.+)/,1),null!==B[H][1]&&(r.train.test(B[H][1])?(T=m=h="",R="KLM",$=v,F=b,ASSERT(x,$,C,F,R)&&M.push({departurePlatform:D,departureName:$,departureTelephone:A,departureUrl:P,departureAddress:k,departureTime:x,arrivalPlatform:z,arrivalName:F,arrivalTelephone:I,arrivalUrl:_,arrivalAddress:j,arrivalTime:C,provider:R,trainName:U,trainNumber:E,passengers:O})):(B[H][1]&&(T=g.getDetachedSpan(B[H][1].toString()).innerCapture(r.flightNumber,1),m=g.getDetachedSpan(B[H][1].toString()).innerCapture(r.flightNumber,2),h=g.getDetachedSpan(B[H][1].toString()).innerCapture(r.operatedBy,1)),ASSERT(x,v,C,b)&&(h||(h="KLM"),L.push({airlineCode:T,airlineName:h.trim(),flightNumber:m,departureAirport:v,departureTime:x,arrivalAirport:b,arrivalTime:C,passengers:O}))));var q,G=g.getSpan().nextText(r.seats).parentTag("table5").allInnerTags("table6"),Q=[];for(H=0;H<L.length;H++)for(var V=L[H],W=Object.keys(V.passengers),X=0;X<W.length;X++){var Y=V.passengers[W[X]];G.length>0&&(q=G[H].nextText(W[X]).nextAnyTag("td").tagContents());var Z={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:V.airlineName,airlineCode:V.airlineCode,flightNumber:V.flightNumber,departureAirportFuzzy:V.departureAirport,departureAirportCode:V.departureCode,departureTime:V.departureTime,arrivalAirportFuzzy:V.arrivalAirport,arrivalAirportCode:V.arrivalCode,arrivalTime:V.arrivalTime},underName:{"@type":"http://schema.org/Person",name:Y.name,email:Y.email},checkinUrl:i,reservationId:n,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:Y.totalPrice,priceCurrency:Y.priceCurrency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:Y.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:q,seatingType:Y.seatingType[V.flightNumber]}}};valid(Y.membershipNumber,Y.programName)&&(Z.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:Y.membershipNumber,programName:Y.programName}),Q.push(Z)}for(H=0;H<M.length;H++)for(V=M[H],W=Object.keys(V.passengers),X=0;X<W.length;X++){Y=V.passengers[W[X]];Q.push({"@context":"http://schema.org","@type":"http://schema.org/TrainReservation",reservationFor:{"@type":"http://schema.org/TrainTrip",departurePlatform:V.departurePlatform,departureStation:{"@type":"http://schema.org/TrainStation",name:V.departureName,telephone:V.departureTelephone,url:V.departureUrl,address:V.departureAddress},departureTime:V.departureTime,arrivalPlatform:V.arrivalPlatform,arrivalStation:{"@type":"http://schema.org/TrainStation",name:V.arrivalName,telephone:V.arrivalTelephone,url:V.arrivalUrl,address:V.arrivalAddress},arrivalTime:V.arrivalTime,provider:{"@type":"http://schema.org/Organization",name:V.provider},trainName:V.trainName,trainNumber:V.trainNumber}})}if(Q.length)return Q}}).call();