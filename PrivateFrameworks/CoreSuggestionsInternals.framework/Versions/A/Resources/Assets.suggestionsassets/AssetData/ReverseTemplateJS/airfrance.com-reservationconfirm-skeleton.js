(function(){return function(e,t,r){function a(){return{reservationId:null,reservationStatus:null,totalPrice:null,priceCurrency:null}}function n(){return{checkinUrl:null,airlineCode:null,airlineName:null,flightNumber:null,departureAirportFuzzy:null,departureAirportCode:null,departureTime:null,arrivalAirportFuzzy:null,arrivalAirportCode:null,arrivalTime:null,seatingType:null}}function i(){return{name:null,email:null,telephone:null,membershipNumber:null,programName:null,ticketNumber:null}}function l(){return{seatNumber:null,seatingType:null}}function g(e){return e.tagContents().innerCapture(/.*, .* \((.*)\),[\s]?.*/,1)}function u(e){return e.tagContents().innerCapture(/(.*) \(.*\),[\s]?.*/,1).trim()}var o=a(),p=[],T=[],s=[],m=Scanner.fromMessage(e),d=[];if(m.setLocale(t),(x=m.getSpan().nextText(r.travelTableTitle).nextTag("table4").nextText(r.flightTableTitle).parentTag("td5")).isNullSpan_&&(x=m.getSpan().nextText(r.travelTableTitle).nextTag("table4").nextTag("td5")),x.isNullSpan_)var x=m.getSpan().nextText(r.travelAlt).nextTag("table4").nextText(r.flightAlt).parentTag("td5");for(var c=x.nextText(r.paymentTableTitle).nextText(r.passengerTableTitle).nextTag("table5"),b=c.nextTag("td6");b!==m.getNullSpan()&&c.contains(b);){var h=i();if(h.name=b.tagContents(),""===b.nextTag("td6").nextTag("td6").tagContents().toString())b=b.nextTag("td6"),T.push(h);else{var v=(b=b.nextTag("td6").nextTag("td6")).innerCapture(new RegExp(r.membershipLabel+"\\s*([A-Za-z ]*)\\s+([0-9]*)"));v&&null!==v[2]&&(h.membershipNumber=v[2].tagContents()),v&&null!==v[1]&&(h.programName=v[1].tagContents()),h.ticketNumber=b.innerCapture(regExpFormatted(/\s*\:\s*([\d|\s]+)/,r.ticketNumberLabel),1).trim(),T.push(h),r.extraPassengerSpacing&&(b=b.nextTag("table6").nextTag("table6").nextTag("table6").nextTag("table6").nextTag("td6").nextTag("td6").nextTag("td6")),b=b.nextTag("td6")}}var C,N,y,f,S,A,z=c.nextText(r.preferencesTableTitle).nextTag("table5");for(o.totalPrice=m.getSpan().nextTag("table4").nextText(r.ticketPriceLabel).nextTag("td6").tagContents(),o.priceCurrency=o.totalPrice.nextTag("td6").tagContents(),o.reservationId=m.getSpan().next(r.reservationIdLabel).parentAnyTag("td").tagContents().innerCapture(/:\s*?([A-Z\d]+)/,1),o.reservationStatus="http://schema.org/ReservationConfirmed",C=x.nextTag("table6");C!==m.getNullSpan()&&x.contains(C);){var F=n();f=C.previousDate(),(y=(N=C.nextTag("td6")).tagContents().innerCapture(/($<airlineCode>.{2})($<flightNumber>.*)\s+-\s+($<seatingType>.*)/))&&(F.airlineCode=y.$airlineCode,F.flightNumber=y.$flightNumber,F.seatingType=y.$seatingType);var k=N.nextTag("td6").nextDate();F.departureTime=getFuzzyDate(m.getDetachedSpan(f.toString()+" "+k.toString()));var D=k.nextTag("td6");F.departureAirportCode=g(D),F.departureAirportFuzzy=u(D);var P=D.nextTag("td6").nextTag("td6").nextTag("td6").nextTag("td6").nextTag("td6").nextDate();F.arrivalTime=getFuzzyDate(m.getDetachedSpan(f.toString()+" "+P.toString())),unSpanDate_(F.departureTime)>unSpanDate_(F.arrivalTime)&&(F.arrivalTime=modifyDate(F.arrivalTime,1));var I=P.nextTag("td6");F.arrivalAirportCode=g(I),F.arrivalAirportFuzzy=u(I),ASSERT(F.airlineCode,F.flightNumber,F.arrivalTime,F.arrivalAirportCode,F.departureTime,F.departureAirportCode)&&p.push(F),C=C.nextTag("table6").nextTag("table6")}var $=z;for(A=0;A<T.length;A++){$=$.nextTag("tr6");var L=[];for(S=0;S<p.length;S++){var R=l(),E=($=$.nextTag("tr6")).nextTag("td6").nextTag("td6").nextTag("td6").nextTag("td6").tagContents();"-"!==E.toString()&&(R.seatNumber=E),L.push(R)}s.push(L),$=$.nextTag("tr6").nextTag("tr6")}for(S=0;S<p.length;S++){F=p[S];for(A=0;A<T.length;A++){var U=T[A],_={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineCode:F.airlineCode,airlineName:F.airlineName,flightNumber:F.flightNumber,departureAirportFuzzy:F.departureAirportFuzzy,departureAirportCode:F.departureAirportCode,departureTime:F.departureTime,arrivalAirportFuzzy:F.arrivalAirportFuzzy,arrivalAirportCode:F.arrivalAirportCode,arrivalTime:F.arrivalTime},underName:{"@type":"http://schema.org/Person",name:U.name},checkinUrl:"",reservationId:o.reservationId,reservationStatus:o.reservationStatus,totalPrice:o.totalPrice,priceCurrency:o.priceCurrency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:U.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:s[A][S].seatNumber,seatingType:F.seatingType}}};valid(OR(U.membershipNumber,U.programName))&&(_.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:U.membershipNumber,programName:U.programName}),d.push(_)}}return d.length?d:CONTINUE}}).call();