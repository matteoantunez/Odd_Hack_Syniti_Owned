(function(){return function(e,t,r){var a,i,n=Scanner.fromMessage(e),o=n.getSpan();n.setLocale(t);var T,m,p,l,g,x,d,s,u,v,c;a=o.nextText(r.reservationIdPrefix).nextTag("td3").tagContents();(m=o.nextText(r.totalCostPrefix).parentTag("td3").tagContents().innerCapture(regExpFormatted(/\1(.+)/,r.totalCostPrefix),1)).innerCapture(/([\d,.-]+)/,1),m.innerCapture(/([^\d,.-\w]+)/,1).trim();var C,b=!0;(C=o.nextText(r.singleTripPrefix)).exists()||(b=!1,(C=o.nextText(r.roundTripPrefix)).exists()||(C=o.nextText(r.conjectionPrefix))),C=C.nextTag("table3").allInnerTagsFiltered("tr3");for(var f,h=[],A=0;A<C.length;A++){var N;f={},N=/\u7968\u53f7\uff1a/.test(C[A])?C[A].innerCapture(/($<name>.+?)\[.*\u7968\u53f7\uff1a($<ticketNumber>.+)/):C[A].innerCapture(/($<name>.+?)\[/),f.name=N.$name.trim(),f.ticketNumber=N.$ticketNumber,f.ticketNumber&&(f.ticketNumber=f.ticketNumber.trim()),h.push(f)}var P=[];if(b)f={},[,u,c,s]=o.nextText(r.singleTripPrefix).nextTag("table3").nextTag("tr2").nextTag("td2").nextTag("td2").tagContents().innerCapture(/(.+)\u2192(.+)\s(.+)/),f.departureAirport=u.trim(),f.arrivalAirport=c.trim(),s=s,[,g,x,T]=o.nextText(r.singleTripPrefix).nextTag("table3").nextTag("table3").nextTag("td3").tagContents().innerCapture(/(.+?)\s([A-Z0-9]{2})([\d]+)/),f.airlineName=g,f.airlineCode=x,f.flightNumber=T,d=o.nextText(r.singleTripPrefix).nextTag("table3").nextTag("table4").nextTag("td4").tagContents(),v=o.nextText(r.singleTripPrefix).nextTag("table3").nextTag("table4").nextTag("td4").nextTag("td4").nextTag("td4").tagContents(),f.departureTime=combineDateAndTime(s,d),f.arrivalTime=combineDateAndTime(s,v),Date.parse(f.departureTime)>Date.parse(f.arrivalTime)&&(f.arrivalTime=modifyDate(f.arrivalTime,1)),ASSERT(f.departureAirport,f.arrivalAirport,f.departureTime,f.arrivalTime,f.airlineCode,f.flightNumber)&&P.push(f);else{f={};for(var k=1,y=n.getSpan().nextText(r.legPrefix+""+k);y.exists();)f={},[,u,c,s]=y.nextTag("td2").tagContents().innerCapture(/(.+)\u2192(.+)\s(.+)/),f.departureAirport=u.trim(),f.arrivalAirport=c.trim(),s=s,[,g,x,T]=y.nextTag("table3").nextTag("td3").tagContents().innerCapture(/(.+?)\s([A-Z0-9]{2})([\d]+)/),f.airlineName=g,f.airlineCode=x,f.flightNumber=T,d=y.nextTag("table4").nextTag("td4").tagContents(),v=y.nextTag("table4").nextTag("td4").nextTag("td4").nextTag("td4").tagContents(),f.departureTime=combineDateAndTime(s,d),f.arrivalTime=combineDateAndTime(s,v),Date.parse(f.departureTime)>Date.parse(f.arrivalTime)&&(f.arrivalTime=modifyDate(f.arrivalTime,1)),ASSERT(f.departureAirport,f.arrivalAirport,f.departureTime,f.arrivalTime,f.airlineCode,f.flightNumber)&&P.push(f),y=o.nextText(r.legPrefix+""+ ++k)}var D=[];for(A=0;A<P.length;A++)for(var S=P[A],F=0;F<h.length;F++){var z=h[F];D.push({"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:S.airlineName,airlineCode:S.airlineCode,flightNumber:S.flightNumber,departureAirportFuzzy:S.departureAirport,departureAirportCode:S.departureCode,departureTime:S.departureTime,arrivalAirportFuzzy:S.arrivalAirport,arrivalAirportCode:S.arrivalCode,arrivalTime:S.arrivalTime},underName:{"@type":"http://schema.org/Person",name:z.name},checkinUrl:i,reservationId:a,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:z.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:"",seatingType:""}},totalPrice:p,priceCurrency:l,reservationStatus:"http://schema.org/ReservationConfirmed"})}if(D.length)return D}}).call();