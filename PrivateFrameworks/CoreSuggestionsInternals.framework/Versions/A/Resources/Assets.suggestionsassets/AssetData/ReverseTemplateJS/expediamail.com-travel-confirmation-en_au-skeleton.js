(function(){return function(e,t,r){if(!e||!t||!r)return CONTINUE;var a,n,i,o,p,s,g=Scanner.fromMessage(e);g.setLocale(t);var d,c,m,l,u,h,C,T,x,f,v,y,b,N,k,A,S,$,F,P,D,R=[],I=[],U={},E=[],z=function(e){if(n=e.tagContents().innerCapture(regExpFormatted(/\1:\s+(.*)/,r.car.name),1),d=e.tagContents().innerCapture(regExpFormatted(/\s+\1:\s*(.*)/,r.car.reservationId),1),h=d.nextText(r.car.driver).nextTag("td5").tagContents().innerCapture(/(.*?):/,1),p=e.nextText(r.car.totalPrice).nextTag("td5").tagContents(),i=p.innerCapture(/([\d,.]+)/,1),o=p.innerCapture(/([^\d,.]+)/,1),c=e.nextText(r.car.pickupTime).tagContents().nextDate(),l=c.nextDate(),C=c.parentTag("td5").tagContents().innerCapture(regExpFormatted(/(.*)\s+\1/,h.toString()),1),m=l.nextText(r.car.loc).parentTag("td6").tagContents().innerCapture(regExpFormatted(/\1:\s+(.*)/,r.car.loc),1),u=m,ASSERT(n,c,m,C))return{name:n,reservationId:d,priceCurrency:o,totalPrice:i,pickupTime:c,pickupAddress:m,dropoffTime:l,dropoffAddress:u,brand:h,provider:C}},w=function(e){for(x=e.nextText(r.flight.summary).nextTag("table5"),p=e.nextText(r.flight.price).nextTag("td5").tagContents(),i=p.innerCapture(/([\d,.]+)/,1),o=p.innerCapture(/([^\d,.]+)/,1),d=e.nextTag("table5").nextTag("table5").nextTag("tr5").nextTag("td5").tagContents().innerCapture(regExpFormatted(/\1:\s+(.*)/,r.flight.reservationId),1),G=e.nextText(r.flight.passenger);!G.nextTag("tr5").innerText(r.flight.taxes).exists();)G=G.nextTag("tr5"),n=G.nextTag("td5").tagContents(),U[n.toString()]={name:n,totalPrice:i,priceCurrency:o,seats:{},seatingType:{},ticketNumber:T};for(;x.innerDate().exists();)s=x.nextDate().parentAnyTag("td").tagContents().innerCapture(/\w+\s+(.*)/,1),y=s.nextDate().parentAnyTag("td"),F=y.tagContents().innerCapture(/($<departureAirport>.*)\(($<departureCode>.*)\)/),f=F.$departureCode,F=F.$departureAirport,v=g.getDetachedSpan(s.toString()+" "+y.firstDate().toString()).innerDate(),b=y.nextTag("td5").nextTag("td5"),$=b.tagContents().innerCapture(/($<arrivalAirport>.*)\(($<arrivalCode>.*)\)/),N=$.$arrivalCode,$=$.$arrivalAirport,k=g.getDetachedSpan(s.toString()+" "+b.firstDate().toString()).innerDate(),A=(A=b.nextTag("td5").nextTag("td5")).tagContents().innerCapture(regExpFormatted(/^($<airlineCode>.*)\s+($<airline>.*)\n\1: ($<flightNr>\w+)/,r.flightName)),P=A.$airline,D=A.$flightNr,S=A.$airlineCode,ASSERT(P,D,v,f,k,N)&&E.push({airlineName:P,airlineCode:S,flightNumber:D,reservationId:d,departureAirport:F,departureCode:f,departureTime:v,arrivalAirport:$,arrivalCode:N,arrivalTime:k,passengers:U}),x=x.nextTag("table5")};switch((a=g.getSpan().nextText(r.bookedItems).nextTag("table4")).tagContents().innerCapture(/(\w+):/,1).toString()){case r.carName:I.push(z(a));break;case r.eventName:break;case r.flightName:w(a)}for(var O,L=0;L<I.length;L++)H={"@context":"http://schema.org","@type":"http://schema.org/RentalCarReservation",totalPrice:(O=I[L]).totalPrice,priceCurrency:O.priceCurrency,reservationId:O.reservationId,reservationStatus:"http://schema.org/Reservation"+(O.reservationStatus||"Confirmed"),checkinUrl:O.checkinUrl,modifyReservationUrl:O.modifyReservationUrl,cancelReservationUrl:O.cancelReservationUrl,underName:{"@type":"http://schema.org/Person",name:O.name,email:O.email},provider:{"@type":"http://schema.org/Organization",name:O.provider},pickupTime:O.pickupTime,pickupLocation:{"@type":"http://schema.org/Place",name:O.pickupName,telephone:O.pickupTelephone,address:O.pickupAddress},dropoffTime:O.dropoffTime,dropoffLocation:{"@type":"http://schema.org/Place",name:O.dropoffName,telephone:O.dropoffTelephone,address:O.dropoffAddress}},O.brand&&(H.reservationFor={"@type":"http://schema.org/Car",brand:{"@type":"http://schema.org/Organization",name:O.brand},license:O.license,color:O.color}),R.push(H);for(var M,j=0;j<E.length;j++){M=E[L];for(var q=Object.keys(M.passengers),B=0;B<q.length;B++){var G=M.passengers[q[B]],H={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:M.airlineName,airlineCode:M.airlineCode,flightNumber:M.flightNumber,departureAirportFuzzy:M.departureAirport,departureAirportCode:M.departureCode,departureTime:M.departureTime,arrivalAirportFuzzy:M.arrivalAirport,arrivalAirportCode:M.arrivalCode,arrivalTime:M.arrivalTime},underName:{"@type":"http://schema.org/Person",name:G.name},checkinUrl:M.checkinUrl,reservationId:M.reservationId,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:G.totalPrice,priceCurrency:G.priceCurrency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:G.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:G.seats[M.flightNumber],seatingType:G.seatingType[M.flightNumber]}}};valid(G.membershipNumber,G.programName)&&(H.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:G.membershipNumber,programName:G.programName}),R.push(H)}}return R.length?R:void 0}}).call();