(function(){return function(e,t,r){var a,n,i,o,g,p,l,s,u,m,h,c,d,C=Scanner.fromMessage(e);C.setLocale(t);var T=[],v=[],S=[];for(a=C.getSpan().innerCapture(regExpFormatted(/\1\s+(.*)/,r.reservationId),1),o=(i=C.getSpan().next(r.priceInfo).next(r.totalPrice).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1\s+(.*)/,r.totalPrice),1)).innerCapture(/([\d,.]+)/,1),g=i.innerCapture(/([^\d,.]+)/,1),s=C.getSpan().next(r.bookingDetails).nextTag("table2").allInnerTags("tr2"),l=2;l<s.length;l++)u={},d=s[l].allInnerTags("td2"),u.name=d[1].tagContents().toString()+" "+d[2].tagContents().toString(),u.ticketNumber=d[3].tagContents(),ASSERT(u.name)&&T.push(u);for(h=C.getSpan().next(r.flightDetails).nextTag("table2").allInnerTags("tr2"),l=1;l<h.length;l+=2)m={},n=(c=h[l].allInnerTags("td2"))[0].tagContents().innerCapture(/($<airlineCode>\D{2})($<flightNumber>\d+)/),m.airlineCode=n.$airlineCode,m.flightNumber=n.$flightNumber,m.departureAirport=c[2].tagContents(),m.arrivalAirport=c[3].tagContents(),m.departureTime=C.getDetachedSpan(c[4].tagContents().toString().replace(/[,\.]/,"")).innerDate(),m.arrivalTime=C.getDetachedSpan(c[5].tagContents().toString().replace(/[,\.]/,"")).innerDate(),m.seatingType=c[6].tagContents(),ASSERT(m.airlineCode,m.flightNumber,m.departureAirport,m.arrivalAirport,m.departureTime,m.arrivalTime)&&v.push(m);for(l=0;l<v.length;l++){m=v[l];for(var f=0;f<T.length;f++){S.push({"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:"TAP Portugal",airlineCode:m.airlineCode,flightNumber:m.flightNumber,departureAirportFuzzy:m.departureAirport,departureTime:m.departureTime,arrivalAirportFuzzy:m.arrivalAirport,arrivalTime:m.arrivalTime},underName:{"@type":"http://schema.org/Person",name:(u=T[f]).name},checkinUrl:p,reservationId:a,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:o,priceCurrency:g,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:u.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:"",seatingType:m.seatingType}}})}}if(S.length)return S}}).call();