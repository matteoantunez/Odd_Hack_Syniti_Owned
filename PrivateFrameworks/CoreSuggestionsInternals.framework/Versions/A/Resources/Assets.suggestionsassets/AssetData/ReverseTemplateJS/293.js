new ReverseTemplateList([new ReverseTemplate("priceline-package-confirmation-en",function(e){return/^Your priceline itinerary for/.test(e.subject)},function(e){function t(e,t){var n=e.innerAddress();if(n.getLength()>0)for(var r=n.split(" ")[0],a=1;a<t.length;a++)if(t[a].toString().split(" ")[0]===r.toString()){e=n;break}return e.toString()}var n=Scanner.fromMessage(e);if(n.setLocale("en_US"),/^Your priceline itinerary for/.test(e.subject)||n.getSpan().nextRegExp(/(.*\([A-Z]{3}\) to .*\([A-Z]{3}\))/).exists()){var r,a,i,o,s,p,g,l,m,d,u,c,x,h,T,C,f,v,S,b,y,N,R,k,A,I,P,D,U,$,F,E,L,O,w,Z,z,j,M,G,H,Y=[],B=[],_=[],q={},J=[],K=[];if(n.getSpan().nextText("time to pack your bags").exists())y=!0,q[(X=n.getSpan().nextText("time to pack your bags!").parentAnyTag("td").tagContents().innerCapture(/(.*), it's time to pack your bags!/,1)).toString()]={name:X.toString(),totalPrice:null,currency:null,seats:{},seatingType:{}},u=n.getSpan().nextText("Departing").parentTag("table5").allInnerTags("table8").map(function(e){return e.allInnerTagsFiltered("td8")}).filter(function(e){return e.length>=3});else{if(o=(i=n.getSpan().nextText("Amount Charged to Card").nextTag("td9").tagContents()).innerCapture(/([\d,.]+)/,1),m=i.nextText("All prices are in").parentAnyTag("td").tagContents().innerCapture(/All prices are in (.*)/,1),(B=n.getSpan().nextText("Passenger and Ticket Information").parentTag("table6").allInnerTags("table9").map(function(e){return e.allInnerTags("td9").map(function(e){return e.tagContents()})}).filter(function(e){return 2===e.length})).length)for(var Q=0,V=B.length;Q<V;Q+=4)X=B[Q][1],not(X)||(q[X.toString()]={name:X.toString(),totalPrice:o,currency:m,seats:{},seatingType:{}});u=n.getSpan().nextText("Flight Details").nextTag("table7").allInnerTags("table10").map(function(e){return e.allInnerTagsFiltered("td10")}).filter(function(e){return e.length>=3})}if(u.length){var W;for(Q=0;W=u[Q];Q++)if("Departing"===W[0].toString())f=(a=W[0].withStart(W[0].getStart()-200).innerCapture(/\(($<departureCode>[A-Z]{3})\).+?\(($<arrivalCode>[A-Z]{3})\)/))?a.$departureCode:null,b=a?a.$arrivalCode:null,C=W[1],T=W[2].innerDate();else if("Arriving"===W[0].toString())S=W[1],v=W[2].innerDate();else if("Flight / Class"===W[0].toString()||"Airline / Flight"===W[0].toString()){if(h=(x=W[1].innerCapture(/($<name>.*) ($<flightNumber>\d+)$/))?x.$name:null,c=x?x.$flightNumber:null,y?(d=null,p=W[2]&&W[2].innerCapture(/Conf Number: (.*)/,1)):(d=W[2],p=W[3]&&W[3].innerCapture(/Conf Number: (.*)/,1)),valid(c)){B=Object.keys(q);for(var X,ee=0;X=B[ee];ee++)q[X].seatingType[c.toString()]=d}ASSERT(h,c,C,T,f,S,v,b)&&(_.push({airlineName:h,flightNumber:c,departureAirport:C,departureCode:f,departureTime:T,arrivalAirport:S,arrivalTime:v,arrivalCode:b,reservationId:p,passengers:q}),x=h=c=C=T=f=S=v=b=p=null)}}if(!n.getSpan().nextText("Hotel Reservation").exists()&&!n.getSpan().nextRegExp(/, it's time to pack your bags!/).exists()||n.getSpan().nextRegExp(/(.*\([A-Z]{3}\) to .*\([A-Z]{3}\))/).exists()||(n.getSpan().nextText("Hotel Reservation").exists()?(X=n.getSpan().nextText("Guest Information").nextTag("td9").nextTag("td9").tagContents(),p=n.getSpan().nextText("Guest Information").nextText("Confirmation Number").nextTag("td9").tagContents(),A=(a=n.getSpan().nextText("Hotel Reservation")).nextTag("td9").tagContents(),I=(ge=a.nextTag("table10").nextTag("td10").nextTag("td10").tagContents()).innerPhoneNumber(),P=ge.tagContents(),I.exists()&&(P=P.withEnd(I.getStart()).trim()),ge.innerAddress().getLength()>=P.getLength()&&(P=ge.innerAddress()),N=a.nextText("Check-In").nextTag("td11").innerDate(),R=a.nextText("Check-Out").nextTag("td11").innerDate(),o=n.getSpan().nextText("Summary of Charges").nextText("Total Charges").nextTag("td9").tagContents().innerCapture(/([\d,.]+)/,1)):n.getSpan().nextRegExp(/, it's time to pack your bags!/).exists()&&!n.getSpan().nextRegExp(/(.*\([A-Z]{3}\) to .*\([A-Z]{3}\))/).exists()&&(X=n.getSpan().nextText("Reservation Name").parentAnyTag("td").tagContents().innerCapture(/Reservation Name\s+(.*)$/,1),p=n.getSpan().nextText("Confirmation Number").parentAnyTag("td").tagContents().innerCapture(/Confirmation Number\s+(\d+)$/,1),P=(ge=(A=n.getSpan().nextText("it's time to pack your bags!").nextTag("td8").tagContents()).nextTag("td9").tagContents().innerCapture(/($<address>.*)\n($<phone>.*)/))?ge.$address:null,I=ge?ge.$phone:null,N=n.getSpan().nextText("Check-In").nextDate(),R=n.getSpan().nextText("Check-Out").nextDate()),ASSERT(N,R,P)&&J.push({name:X,reservationId:p,totalPrice:o,priceCurrency:s,checkInDateTime:N,checkOutDateTime:R,hotelName:A,hotelUrl:k,hotelPhone:I,hotelAddress:P})),n.getSpan().nextText("Your Rental Car Confirmation").exists()){H=n.getSpan().next(/Pick-up: \n/).nextDate(),M=n.getSpan().nextText("Rental Location").nextAddress(),Z=n.getSpan().next(/Drop-off: \n/).nextDate(),O=M,X=n.getSpan().next(/Driver Name: \n+(.*?)\s\s/).innerCapture(/Driver Name: \n+(.*?)\s\s/,1).trim(),p=n.getSpan().next(/Confirmation Number: \n+(.*?)\s/).innerCapture(/Confirmation Number: \n+(.*?)\s/,1),D=n.getSpan().next(/Modify Reservation/).nextLink(),U=n.getSpan().next(/Cancel Reservation/).nextLink(),F=n.getSpan().next(/Rental Car Contact Information/).nextTag("td6").tagContents().trim(),p.exists()&&($=n.getSpan().next(/Car Type: \n+(.*)\n/).innerCapture(/Car Type: \n+(.*)\n/,1).trim()),G=w=n.getSpan().next(/Phone Number \n+(.*?)\s\s/).innerCapture(/Phone Number \n+(.*?)\s\s/,1).trim();var te=n.getSpan().next("Estimated Total").nextAnyTag("td");o=te.tagContents().innerCapture(/.*?([\d,.]+)/,1).trim(),s=te.tagContents().innerCapture(/(\w+)\s.*?[\d,.]+/,1).trim(),ASSERT(H,F,p,OR(M,j))&&K.push({name:X,brand:$,pickupTime:H,pickupName:j,pickupAddress:M,pickupTelephone:G,dropoffTime:Z,dropoffName:L,dropoffAddress:O,dropoffTelephone:w,provider:F,reservationId:p,reservationStatus:g,totalPrice:o,priceCurrency:s,modifyReservationUrl:D,cancelReservationUrl:U})}else if(n.getSpan().nextText("Rental Car Confirmation").exists()){if((z=n.getSpan().nextText("Pick-Up").nextTag("table11").allInnerTagsFiltered("td11")).length>=3&&(H=z[0].innerDate(),j=z[1].tagContents(),M=t(M=n.getDetachedSpan(z.slice(2).join(" ")),z)),(E=n.getSpan().nextText("Drop-Off").nextTag("table11").allInnerTagsFiltered("td11")).length>=3&&(Z=E[0].innerDate(),L=E[1].tagContents(),O=t(O=n.getDetachedSpan(E.slice(2).join(" ")),E)),X=n.getSpan().nextText("Driver Name").parentTag("td11").tagContents().innerCapture(/\bDriver Name\s+(.*)/,1),!(p=n.getSpan().nextText("Confirmation Number").parentTag("td11").tagContents().innerCapture(/\bConfirmation Number\s+(\w+)/,1)).exists()){var ne=n.getSpan().next(/Rental Car Confirmation Number.*\n(.*?)\:\s+(\w+)/).innerCapture(/Rental Car Confirmation Number.*\n($<provider>.*?)\:\s+($<reservationId>\w+)/);F=ne.$provider,p=ne.$reservationId}if(D=n.getSpan().innerCapture(/\bChange\s+Reservation\s+<(.*?)>/,1),U=n.getSpan().innerCapture(/\bCancel\s+Reservation\s+<(.*?)>/,1),p.exists()&&(F&&F.exists()||(F=n.getSpan().nextText("Confirmation:").parentTag("td7").tagContents().innerCapture(regExpFormatted(/\b(.*) Confirmation: \1/,p.toString()),1)),F.exists())){var re=n.getSpan().nextText("Rental Car Details").nextTag("table9").innerTag("td9").tagContents();($=re.innerCapture(regExpFormatted(/\1 (.*)$/,F.toString()),1)).exists()||re.toString().match(/\n/)&&($=re.withStart(re.next("\n").getEnd()))}G=w=n.getSpan().nextText("Phone Number").nextTag("td10").tagContents().toString().trim(),s=(o=n.getSpan().nextText("Estimated Total Charges").nextTag("td9").tagContents().innerCapture(/.*?([\d,.]+)\(?/,1)).nextTag("td8").tagContents().innerCapture(/\bPrices are in ([A-Z]+)/,1),ASSERT(H,F,p,OR(M,j))&&K.push({name:X,brand:$,pickupTime:H,pickupName:j,pickupAddress:M,pickupTelephone:G,dropoffTime:Z,dropoffName:L,dropoffAddress:O,dropoffTelephone:w,provider:F,reservationId:p,reservationStatus:g,totalPrice:o,priceCurrency:s,modifyReservationUrl:D,cancelReservationUrl:U})}for(Q=0;Q<_.length;Q++)for(var ae=_[Q],ie=Object.keys(ae.passengers),oe=0;oe<ie.length;oe++){var se=ae.passengers[ie[oe]];r={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:ae.airlineName,flightNumber:ae.flightNumber,departureAirportFuzzy:ae.departureAirport,departureAirportCode:ae.departureCode,departureTime:ae.departureTime,arrivalAirportFuzzy:ae.arrivalAirport,arrivalAirportCode:ae.arrivalCode,arrivalTime:ae.arrivalTime},underName:{"@type":"http://schema.org/Person",name:se.name},checkinUrl:l,reservationId:ae.reservationId,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:se.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:se.seats[ae.flightNumber],seatingType:se.seatingType[ae.flightNumber]}},totalPrice:se.totalPrice,priceCurrency:se.currency,reservationStatus:"http://schema.org/ReservationConfirmed"},not(se.membershipNumber)||(r.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:se.membershipNumber,programName:se.programName}),Y.push(r)}var pe;for(Q=0;Q<K.length;Q++)r={"@context":"http://schema.org","@type":"http://schema.org/RentalCarReservation",totalPrice:(pe=K[Q]).totalPrice,priceCurrency:pe.priceCurrency,reservationId:pe.reservationId,reservationStatus:"http://schema.org/Reservation"+(pe.reservationStatus||"Confirmed"),checkinUrl:pe.checkinUrl,modifyReservationUrl:pe.modifyReservationUrl,cancelReservationUrl:pe.cancelReservationUrl,underName:{"@type":"http://schema.org/Person",name:pe.name,email:pe.email},provider:{"@type":"http://schema.org/Organization",name:pe.provider},pickupTime:pe.pickupTime,pickupLocation:{"@type":"http://schema.org/Place",name:pe.pickupName,telephone:pe.pickupTelephone,address:pe.pickupAddress},dropoffTime:pe.dropoffTime,dropoffLocation:{"@type":"http://schema.org/Place",name:pe.dropoffName,telephone:pe.dropoffTelephone,address:pe.dropoffAddress}},pe.brand.exists()&&(r.reservationFor={"@type":"http://schema.org/Car",brand:{"@type":"http://schema.org/Organization",name:pe.brand},license:pe.license,color:pe.color}),Y.push(r);var ge;for(Q=0;Q<J.length;Q++)Y.push(r={"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:(ge=J[Q]).name,email:ge.email},totalPrice:ge.totalPrice,priceCurrency:ge.priceCurrency,checkinTime:ge.checkInDateTime,checkoutTime:ge.checkOutDateTime,modifyReservationUrl:ge.modifyReservationUrl,cancelReservationUrl:ge.cancelReservationUrl,reservationStatus:"http://schema.org/Reservation"+(ge.reservationStatus||"Confirmed"),reservationId:ge.reservationId,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:ge.hotelName,url:ge.hotelUrl,telephone:ge.hotelPhone,address:ge.hotelAddress}});if(Y.length)return Y}},"SG3a8e08f2")]);